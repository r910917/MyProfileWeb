<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>司機管理</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; background:#f7fbff; margin:0; padding:20px; }
    h2 { color:#005c4b; margin: 10px 0 6px; }
    .wrap { max-width: 1000px; margin: 0 auto; }
    .section { background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.06); padding:16px 18px; margin:16px 0; }
    label { display:block; font-weight:bold; margin:10px 0 6px; }
    input, select, textarea {
      width:100%; padding:10px; border-radius:8px; border:1px solid #d7dde5; background:#fcfdff;
    }
    .row { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; }
    .row-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    .actions { display:flex; gap:10px; margin-top:12px; }
    button {
      padding:10px 16px; border:none; border-radius:8px; color:#fff; cursor:pointer; font-weight:bold;
      background:#007bff;
    }
    button.secondary { background:#28a745; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; margin-left:8px; }
    .pill.on { background:#e3f7ec; color:#1f7a3b; border:1px solid #a7e2bf; }
    .pill.off{ background:#fdeeee; color:#a63f3f; border:1px solid #f3b6b6; }
    .note { font-size: 12px; color:#666; }
    .msg { margin:8px 0; padding:10px 12px; border-radius:8px; font-weight:bold; }
    .msg.ok { background:#e8f8ef; color:#206b3a; }
    .msg.warn { background:#fff7e6; color:#9a6b00; }
    .msg.err { background:#ffefef; color:#9a2a2a; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
    .table th { background:#f6f9fc; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>司機管理：{{ driver.driver_name }}
      {% if driver.is_active %}
        <span class="pill on">上架中</span>
      {% else %}
        <span class="pill off">未上架</span>
      {% endif %}
    </h2>
    <p class="note">路線：{{ driver.departure }} → {{ driver.destination }}　｜　座位：{{ driver.seats_filled }} / {{ driver.seats_total }}</p>

    {% if saved_msg %}<div class="msg ok">{{ saved_msg }}</div>{% endif %}
    {% if matched_msg %}<div class="msg ok">{{ matched_msg }}</div>{% endif %}
    {% if full_msg %}<div class="msg warn">{{ full_msg }}</div>{% endif %}

    <!-- 上半：編輯司機 -->
    <div class="section">
      <h3>🛠️ 編輯司機資料</h3>
      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="form" value="update_driver">
        <div class="row">
          <div>
            <label>暱稱</label>
            <input type="text" name="driver_name" value="{{ driver.driver_name }}" required>
          </div>
          <div>
            <label>性別</label>
            <select name="gender">
              <option value="M" {% if driver.gender == "M" %}selected{% endif %}>男生</option>
              <option value="F" {% if driver.gender == "F" %}selected{% endif %}>女生</option>
              <option value="X" {% if driver.gender == "X" %}selected{% endif %}>不方便透漏</option>
            </select>
          </div>
          <div>
            <label>Email（可留空）</label>
            <input type="email" name="email" value="{{ driver.email|default_if_none:'' }}">
          </div>
          <div>
            <label>聯絡方式</label>
            <input type="text" name="contact" value="{{ driver.contact }}" placeholder="LINE ID / IG / Phone Number" required>
          </div>
          <div>
            <label>管理密碼（留空則不變更）</label>
            <input type="password" name="password" placeholder="留空不修改">
          </div>
          <div>
            <label>總座位</label>
            <input type="number" name="seats_total" min="1" value="{{ driver.seats_total }}" required>
          </div>
        </div>

        <div class="row-3" style="margin-top:10px;">
          <div>
            <label>出發地</label>
            <input type="text" name="departure" value="{{ driver.departure }}" required>
          </div>
          <div>
            <label>目的地</label>
            <input type="text" name="destination" value="{{ driver.destination }}" required>
          </div>
          <div>
            <label>出發日期</label>
            <input type="date" name="date" value="{{ driver.date|date:'Y-m-d' }}" required>
          </div>
          <div>
            <label>回程日期（可留空）</label>
            <input type="date" name="return_date" value="{{ driver.return_date|date:'Y-m-d' }}">
          </div>
          <div>
            <label>順路接送意願</label>
            <select name="flexible_pickup">
              <option value="YES" {% if driver.flexible_pickup == "YES" %}selected{% endif %}>順路可載</option>
              <option value="NO"  {% if driver.flexible_pickup == "NO"  %}selected{% endif %}>不順路也OK</option>
              <option value="MAYBE" {% if driver.flexible_pickup == "MAYBE" %}selected{% endif %}>視情況</option>
            </select>
          </div>
          <div>
            <label>是否上架</label>
            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
              <input type="checkbox" name="is_active" id="is_active" {% if driver.is_active %}checked{% endif %}>
              <label for="is_active" style="margin:0;font-weight:normal;">上架（座位滿會自動下架）</label>
            </div>
          </div>
        </div>

        <label style="margin-top:12px;">備註</label>
        <textarea name="note" rows="3" placeholder="補充說明">{{ driver.note }}</textarea>

        <div class="actions">
          <button type="submit">💾 儲存</button>
          <a href="{% url 'find_index' %}" style="text-decoration:none;">
            <button type="button" class="secondary">🏠 回首頁</button>
          </a>
        </div>
      </form>
    </div>

    <h4>🧍 已登記乘客</h4>

<h5>待確認</h5>
<ul class="pax-list">
  {% if pending %}
    {% for p in pending %}
      <li class="pax-item pax-pending">
        <div class="pax-row">
          <!-- 標題列 -->
          <div class="pax-head">
            <span class="pax-name">{{ p.passenger_name }}</span>
            <span class="badge gender">{{ p.get_gender_display }}</span>
            {% if p.together_return is not None %}
              <span class="badge rt">回程：{{ p.together_return|yesno:"一起,不一起" }}</span>
            {% endif %}
          </div>

          <!-- 重點欄（多欄） -->
          <div class="pax-grid">
            <div class="pax-cell"><label>出發地</label><div>{{ p.departure|default:"未填" }}</div></div>
            <div class="pax-cell"><label>目的地</label><div>{{ p.destination|default:"未填" }}</div></div>
            <div class="pax-cell"><label>人數</label><div>{{ p.seats_needed }}</div></div>
            <div class="pax-cell">
              <label>願付</label>
              <div>{% if p.willing_to_pay %}NT$ {{ p.willing_to_pay|floatformat:0 }}{% else %}未填{% endif %}</div>
            </div>
            <div class="pax-cell"><label>日期</label><div>{{ p.date }}</div></div>
            <div class="pax-cell"><label>回程</label><div>{{ p.return_date|default:"未定" }}</div></div>
            <div class="pax-cell span-2"><label>聯絡方式</label><div>{{ p.contact|default:"未填" }}</div></div>
          </div>

          {% if p.note %}
            <div class="pax-note">備註：{{ p.note }}</div>
          {% endif %}

          <!-- 操作 -->
          <div class="pax-actions">
            <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">編輯</button>
            <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">刪除</button>
          </div>
        </div>
      </li>
    {% endfor %}
  {% else %}
    <li class="pax-empty">目前沒有待確認乘客</li>
  {% endif %}
</ul>

<h5>已接受</h5>
<ul class="pax-list">
  {% if accepted %}
    {% for p in accepted %}
      <li class="pax-item pax-accepted">
        <span class="check">✔</span>
        <span class="pax-name">{{ p.passenger_name }}</span>
        <span class="pax-meta">
          {{ p.get_gender_display }}・出發：{{ p.departure }}・人數：{{ p.seats_needed }}
        </span>
        <span class="pax-actions">
          <button class="btn-mini" data-pax-edit data-id="{{ p.id }}">編輯</button>
          <button class="btn-mini danger" data-pax-del data-id="{{ p.id }}">刪除</button>
        </span>
      </li>
    {% endfor %}
  {% else %}
    <li class="pax-empty">尚無已接受乘客</li>
  {% endif %}
</ul>
<style>

/* 列表 & 項目 */
.pax-list{list-style:none;margin:10px 0 0;padding:0}
.pax-item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;margin:10px 0}
.pax-row{display:grid;grid-template-columns:1fr auto;grid-row-gap:10px;align-items:start}

/* 標題列 */
.pax-head{grid-column:1/-1;display:flex;align-items:center;gap:8px}
.pax-name{font-weight:700;font-size:15px}
.badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#4338ca}
.badge.gender{background:#e0f2fe;color:#0369a1}
.badge.rt{background:#fef3c7;color:#92400e}

/* 重點欄（多欄） */
.pax-grid{
  grid-column:1/-1;
  display:grid;
  grid-template-columns:repeat(6,minmax(0,1fr)); /* 桌機 6 欄 */
  gap:10px 14px;
}
.pax-cell label{
  display:block;font-size:12px;color:#6b7280;margin-bottom:4px;letter-spacing:.02em
}
.pax-cell div{font-size:14px;color:#111827}
.pax-cell.span-2{grid-column:span 2}

/* 備註 */
.pax-note{grid-column:1/-1;background:#f9fafb;border-radius:10px;padding:8px 10px;font-size:13px;color:#374151}

/* 操作按鈕 */
.pax-actions{display:flex;gap:8px;align-self:center}
.btn-mini{border:0;border-radius:8px;padding:7px 12px;background:#e5e7eb;cursor:pointer;font-weight:600}
.btn-mini:hover{background:#d1d5db}
.btn-mini.danger{background:#fecaca;color:#7f1d1d}
.btn-mini.danger:hover{background:#fca5a5}

/* 手機／平板 RWD */
@media (max-width:1024px){
  .pax-grid{grid-template-columns:repeat(4,minmax(0,1fr))} /* 4 欄 */
}
@media (max-width:768px){
  .pax-row{grid-template-columns:1fr}
  .pax-actions{justify-content:flex-end}
  .pax-grid{grid-template-columns:repeat(2,minmax(0,1fr))} /* 2 欄 */
  .pax-cell.span-2{grid-column:1/-1}
}
@media (max-width:480px){
  .pax-grid{grid-template-columns:1fr} /* 手機單欄 */
}


</style>
</body>
</html>
