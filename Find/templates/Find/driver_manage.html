<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ›  å¸æ©Ÿç®¡ç†</title>
  <style>
    body { font-family:"Microsoft JhengHei",sans-serif; background:linear-gradient(to right,#f0f9ff,#fefefe); margin:0; padding:40px 20px; }
    h2 { text-align:center; color:#005c4b; margin-bottom:25px; font-size:26px; }
    form { max-width:600px; margin:0 auto; background:#fff; padding:25px 30px; border-radius:16px; box-shadow:0 6px 12px rgba(0,0,0,.1); animation:fadeIn .5s ease-in-out; }
    label { font-weight:700; display:block; margin-top:12px; margin-bottom:6px; color:#444; }
    input,textarea,select { width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ccc; transition:border-color .3s, box-shadow .3s; font-size:15px; }
    input:focus,textarea:focus,select:focus { border-color:#007bff; box-shadow:0 0 8px rgba(0,123,255,.3); outline:none; }
    textarea { min-height:80px; resize:vertical; }
    .btn { width:100%; padding:14px; border:0; border-radius:10px; background:linear-gradient(45deg,#007bff,#00b894); color:#fff; font-size:18px; font-weight:700; cursor:pointer; transition:background .3s, transform .2s; }
    .btn:hover { background:linear-gradient(45deg,#0056b3,#009e77); transform:scale(1.02); }
    .btn-danger { background:linear-gradient(45deg,#ef4444,#f97316); }
    .btn-danger:hover { background:linear-gradient(45deg,#b91c1c,#ea580c); }
    .btn-ghost { width:100%; padding:14px; border:0; border-radius:10px; background:linear-gradient(45deg,#007bff,#00b894); color:#fff; font-size:18px; font-weight:700; cursor:pointer; transition:background .3s, transform .2s;}
    .btn-ghost:hover { background:linear-gradient(45deg,#0fbfd2,#402fc7); transform:scale(1.02); }

    .alert { max-width:600px; margin:0 auto 12px; padding:12px 14px; border-radius:10px; }
    .alert-ok { background:#e8f8ef; color:#206b3a; border:1px solid #a7e2bf; }
    .alert-warn { background:#fff7e6; color:#9a6b00; border:1px solid #f7d7a3; }
    .required::after{ content:" *"; color:red; }

    @keyframes fadeIn { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }

    /* ä¹˜å®¢æ¸…å–® */
    .panel { max-width:900px; margin:18px auto; }
    .pax-list{list-style:none;margin:10px auto 0;padding:0;max-width:900px}
    .pax-item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;margin:10px 0;box-shadow:0 3px 8px rgba(0,0,0,.05)}
    .pax-row{display:grid;grid-template-columns:1fr auto;grid-row-gap:10px;align-items:start}
    .pax-head{grid-column:1/-1;display:flex;align-items:center;gap:8px}
    .pax-name{font-weight:700;font-size:15px}
    .badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#4338ca}
    .badge.gender{background:#e0f2fe;color:#0369a1}
    .badge.rt{background:#fef3c7;color:#92400e}
    .pax-grid{grid-column:1/-1;display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px 14px}
    .pax-cell label{display:block;font-size:12px;color:#6b7280;margin-bottom:4px;letter-spacing:.02em}
    .pax-cell div{font-size:14px;color:#111827}
    .pax-cell.span-2{grid-column:span 2}
    .pax-note{grid-column:1/-1;background:#f9fafb;border-radius:10px;padding:8px 10px;font-size:13px;color:#374151}
    .pax-actions{display:flex;gap:8px;align-self:center}
    .btn-mini{border:0;border-radius:8px;padding:7px 12px;background:#e5e7eb;cursor:pointer;font-weight:600}
    .btn-mini:hover{background:#d1d5db}
    .btn-mini.danger{background:#fecaca;color:#7f1d1d}
    .btn-mini.danger:hover{background:#fca5a5}

    @media (max-width:1024px){ .pax-grid{grid-template-columns:repeat(4,minmax(0,1fr))} }
    @media (max-width:768px){
      form { padding:18px 16px; }
      .pax-row{grid-template-columns:1fr}
      .pax-actions{justify-content:flex-end}
      .pax-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
      .pax-cell.span-2{grid-column:1/-1}
    }
    @media (max-width:480px){ .pax-grid{grid-template-columns:1fr} }
    /* éšç‰ˆã€Œæ˜¯å¦é–‹æ”¾ã€switch */
    /* Switch å®¹å™¨ï¼šæ°´å¹³ç½®ä¸­ã€å°é½Šå¥½çœ‹ */
.switch{
  display:flex; align-items:center; justify-content:center;
  gap:12px; margin:10px 0;
}

/* éš±è—åŸç”Ÿ checkboxï¼ˆä»å¯è¢« label é»æ“Šï¼‰ */
.switch input[type="checkbox"]{
  position:absolute; opacity:0; width:0; height:0;
}

/* è‡ªè¨‚ toggle å¤–è§€ï¼ˆè»Œé“ï¼‰ */
.switch .toggle{
  position:relative; width:52px; height:30px; border-radius:999px;
  background:#e5e7eb; box-shadow:inset 0 0 0 1px rgba(0,0,0,.06);
  transition:background .2s ease;
  cursor:pointer; display:inline-block;
}

/* åœ“å½¢æŠŠæ‰‹ */
.switch .toggle::after{
  content:""; position:absolute; top:3px; left:3px;
  width:24px; height:24px; border-radius:50%;
  background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.2);
  transition:transform .2s ease;
}

/* å‹¾é¸ç‹€æ…‹ï¼šè®Šè‰² + æŠŠæ‰‹å³ç§» */
.switch input[type="checkbox"]:checked + .toggle{
  background:#10b981; /* ç¶ è‰² */
}
.switch input[type="checkbox"]:checked + .toggle::after{
  transform:translateX(22px);
}

/* Label æ–‡å­— */
.switch label{
  font-weight:600; color:#374151; cursor:pointer;
}

/* é¡å¤–ç‹€æ…‹æç¤ºï¼ˆå¯é¸ï¼‰ */
.switch .hint{
  display:block; font-size:12px; color:#6b7280; margin-top:2px; text-align:center;
}

/* æ‰‹æ©ŸåŠ å¤§å¯é»å€åŸŸ */
@media (max-width:640px){
  .switch .toggle{ width:56px; height:34px; }
  .switch .toggle::after{ width:26px; height:26px; top:4px; left:4px; transform:none; }
  .switch input[type="checkbox"]:checked + .toggle::after{ transform:translateX(22px); }
}
  </style>
</head>
<body>
  <h2>ğŸ›  å¸æ©Ÿç®¡ç†</h2>

  {% if saved_msg %}<div class="alert alert-ok">{{ saved_msg }}</div>{% endif %}
  {% if matched_msg %}<div class="alert alert-ok">{{ matched_msg }}</div>{% endif %}
  {% if full_msg %}<div class="alert alert-warn">{{ full_msg }}</div>{% endif %}

  <!-- A) ç·¨è¼¯å¸æ©Ÿè³‡æ–™ -->
  <form method="POST">
    {% csrf_token %}
    <input type="hidden" name="form" value="update_driver" />

    <label class="required">æš±ç¨±</label>
    <input type="text" name="driver_name" value="{{ driver.driver_name }}" required />

    <label class="required">æ€§åˆ¥</label>
    <select name="gender" required>
      <option value="M" {% if driver.gender == 'M' %}selected{% endif %}>ç”·ç”Ÿ</option>
      <option value="F" {% if driver.gender == 'F' %}selected{% endif %}>å¥³ç”Ÿ</option>
      <option value="X" {% if driver.gender == 'X' %}selected{% endif %}>ä¸æ–¹ä¾¿é€æ¼</option>
    </select>

    <label>Emailï¼ˆé¸å¡«ï¼‰</label>
    <input type="email" name="email" value="{{ driver.email|default_if_none:'' }}" />

    <label class="required">è¯çµ¡æ–¹å¼</label>
    <input type="text" name="contact" value="{{ driver.contact }}" placeholder="LINE / IG / Phone Number" required />

    <label>ç®¡ç†å¯†ç¢¼ï¼ˆç•™ç©ºä¸è®Šæ›´ï¼‰</label>
    <input type="password" name="password" placeholder="ç•™ç©ºä¸ä¿®æ”¹" />

    <label class="required">ç¸½åº§ä½</label>
    <input type="number" name="seats_total" min="1" value="{{ driver.seats_total }}" required />

    <!-- å‡ºç™¼åœ°ï¼ˆä¸‹æ‹‰ + è‡ªå¡«ï¼‰ -->
    {% with has_dep_custom=driver.departure_custom %}
    <label class="required">å‡ºç™¼åœ°</label>
    <select name="departure" id="departure" onchange="checkCustomDeparture(this)" required>
      <option value="" {% if not driver.departure and not has_dep_custom %}selected{% endif %}>è«‹é¸æ“‡ç¸£å¸‚</option>
      <option value="è‡ªå¡«" {% if has_dep_custom %}selected{% endif %}>å…¶ä»–</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©é„‰" {% if not has_dep_custom and driver.departure == 'èŠ±è“®ç¸£å…‰å¾©é„‰' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©é„‰</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™" {% if not has_dep_custom and driver.departure == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™" {% if not has_dep_custom and driver.departure == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™</option>
      <option value="å…‰å¾©é„‰ç³–å» " {% if not has_dep_custom and driver.departure == 'å…‰å¾©é„‰ç³–å» ' %}selected{% endif %}>å…‰å¾©é„‰ç³–å» </option>
      <option value="éœ€æ¸…æ·¤åœ°å€" {% if not has_dep_custom and driver.departure == 'éœ€æ¸…æ·¤åœ°å€' %}selected{% endif %}>éœ€æ¸…æ·¤åœ°å€</option>
      <option value="å°åŒ—å¸‚" {% if not has_dep_custom and driver.departure == 'å°åŒ—å¸‚' %}selected{% endif %}>å°åŒ—å¸‚</option>
      <option value="æ–°åŒ—å¸‚" {% if not has_dep_custom and driver.departure == 'æ–°åŒ—å¸‚' %}selected{% endif %}>æ–°åŒ—å¸‚</option>
      <option value="åŸºéš†å¸‚" {% if not has_dep_custom and driver.departure == 'åŸºéš†å¸‚' %}selected{% endif %}>åŸºéš†å¸‚</option>
      <option value="æ¡ƒåœ’å¸‚" {% if not has_dep_custom and driver.departure == 'æ¡ƒåœ’å¸‚' %}selected{% endif %}>æ¡ƒåœ’å¸‚</option>
      <option value="æ–°ç«¹å¸‚" {% if not has_dep_custom and driver.departure == 'æ–°ç«¹å¸‚' %}selected{% endif %}>æ–°ç«¹å¸‚</option>
       <option value="æ–°ç«¹ç¸£"  {% if not has_dep_custom and driver.departure == 'æ–°ç«¹ç¸£' %}selected{% endif %}>æ–°ç«¹ç¸£</option>
      <option value="è‹—æ —ç¸£"  {% if not has_dep_custom and driver.departure == 'è‹—æ —ç¸£' %}selected{% endif %}>è‹—æ —ç¸£</option>
      <option value="å°ä¸­å¸‚"  {% if not has_dep_custom and driver.departure == 'å°ä¸­å¸‚' %}selected{% endif %}>å°ä¸­å¸‚</option>
      <option value="å½°åŒ–ç¸£"  {% if not has_dep_custom and driver.departure == 'å½°åŒ–ç¸£' %}selected{% endif %}>å½°åŒ–ç¸£</option>
      <option value="å—æŠ•ç¸£"  {% if not has_dep_custom and driver.departure == 'å—æŠ•ç¸£' %}selected{% endif %}>å—æŠ•ç¸£</option>
      <option value="é›²æ—ç¸£"  {% if not has_dep_custom and driver.departure == 'é›²æ—ç¸£' %}selected{% endif %}>é›²æ—ç¸£</option>
      <option value="å˜‰ç¾©å¸‚"  {% if not has_dep_custom and driver.departure == 'å˜‰ç¾©å¸‚' %}selected{% endif %}>å˜‰ç¾©å¸‚</option>
      <option value="å˜‰ç¾©ç¸£"  {% if not has_dep_custom and driver.departure == 'å˜‰ç¾©ç¸£' %}selected{% endif %}>å˜‰ç¾©ç¸£</option>
      <option value="å°å—å¸‚"  {% if not has_dep_custom and driver.departure == 'å°å—å¸‚' %}selected{% endif %}>å°å—å¸‚</option>
      <option value="é«˜é›„å¸‚"  {% if not has_dep_custom and driver.departure == 'é«˜é›„å¸‚' %}selected{% endif %}>é«˜é›„å¸‚</option>
      <option value="å±æ±ç¸£"  {% if not has_dep_custom and driver.departure == 'å±æ±ç¸£' %}selected{% endif %}>å±æ±ç¸£</option>
      <option value="å®œè˜­ç¸£"  {% if not has_dep_custom and driver.departure == 'å®œè˜­ç¸£' %}selected{% endif %}>å®œè˜­ç¸£</option>
      <option value="èŠ±è“®ç¸£"  {% if not has_dep_custom and driver.departure == 'èŠ±è“®ç¸£' %}selected{% endif %}>èŠ±è“®ç¸£</option>
      <option value="å°æ±ç¸£"  {% if not has_dep_custom and driver.departure == 'å°æ±ç¸£' %}selected{% endif %}>å°æ±ç¸£</option>
      <option value="æ¾æ¹–ç¸£"  {% if not has_dep_custom and driver.departure == 'æ¾æ¹–ç¸£' %}selected{% endif %}>æ¾æ¹–ç¸£</option>
      <option value="é‡‘é–€ç¸£"  {% if not has_dep_custom and driver.departure == 'é‡‘é–€ç¸£' %}selected{% endif %}>é‡‘é–€ç¸£</option>
      <option value="é€£æ±Ÿç¸£"  {% if not has_dep_custom and driver.departure == 'é€£æ±Ÿç¸£' %}selected{% endif %}>é€£æ±Ÿç¸£</option>
      <!-- å…¶é¤˜ç¸£å¸‚ç…§é€™å€‹å¯«æ³•æ“´å…… -->
    </select>
    <input type="text"
           id="customDeparture"
           name="departure_custom"
           value="{{ driver.departure_custom|default:'' }}"
           style="display:{% if has_dep_custom %}block{% else %}none{% endif %};"
           placeholder="è¼¸å…¥è‡ªè¨‚å‡ºç™¼åœ°" />
    {% endwith %}

    <!-- ç›®çš„åœ°ï¼ˆä¸‹æ‹‰ + è‡ªå¡«ï¼‰ -->
    {% with has_des_custom=driver.destination_custom %}
    <label>ç›®çš„åœ°</label>
    <select name="destination" id="destination" onchange="checkCustomDestination(this)">
      <option value="" {% if not driver.destination and not has_des_custom %}selected{% endif %}>è«‹é¸æ“‡ç¸£å¸‚</option>
      <option value="è‡ªå¡«" {% if has_des_custom %}selected{% endif %}>å…¶ä»–</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©é„‰" {% if not has_des_custom and driver.destination == 'èŠ±è“®ç¸£å…‰å¾©é„‰' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©é„‰</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™" {% if not has_des_custom and driver.destination == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™" {% if not has_des_custom and driver.destination == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™</option>
      <option value="å…‰å¾©é„‰ç³–å» " {% if not has_des_custom and driver.destination == 'å…‰å¾©é„‰ç³–å» ' %}selected{% endif %}>å…‰å¾©é„‰ç³–å» </option>
      <option value="éœ€æ¸…æ·¤åœ°å€" {% if not has_des_custom and driver.destination == 'éœ€æ¸…æ·¤åœ°å€' %}selected{% endif %}>éœ€æ¸…æ·¤åœ°å€</option>
      <option value="å°åŒ—å¸‚" {% if not has_des_custom and driver.destination == 'å°åŒ—å¸‚' %}selected{% endif %}>å°åŒ—å¸‚</option>
      <option value="æ–°åŒ—å¸‚"  {% if not has_des_custom and driver.destination == 'æ–°åŒ—å¸‚' %}selected{% endif %}>æ–°åŒ—å¸‚</option>
      <option value="åŸºéš†å¸‚"  {% if not has_des_custom and driver.destination == 'åŸºéš†å¸‚' %}selected{% endif %}>åŸºéš†å¸‚</option>
      <option value="æ¡ƒåœ’å¸‚"  {% if not has_des_custom and driver.destination == 'æ¡ƒåœ’å¸‚' %}selected{% endif %}>æ¡ƒåœ’å¸‚</option>
      <option value="æ–°ç«¹å¸‚"  {% if not has_des_custom and driver.destination == 'æ–°ç«¹å¸‚' %}selected{% endif %}>æ–°ç«¹å¸‚</option>
      <option value="æ–°ç«¹ç¸£"  {% if not has_des_custom and driver.destination == 'æ–°ç«¹ç¸£' %}selected{% endif %}>æ–°ç«¹ç¸£</option>
      <option value="è‹—æ —ç¸£"  {% if not has_des_custom and driver.destination == 'è‹—æ —ç¸£' %}selected{% endif %}>è‹—æ —ç¸£</option>
      <option value="å°ä¸­å¸‚"  {% if not has_des_custom and driver.destination == 'å°ä¸­å¸‚' %}selected{% endif %}>å°ä¸­å¸‚</option>
      <option value="å½°åŒ–ç¸£"  {% if not has_des_custom and driver.destination == 'å½°åŒ–ç¸£' %}selected{% endif %}>å½°åŒ–ç¸£</option>
      <option value="å—æŠ•ç¸£"  {% if not has_des_custom and driver.destination == 'å—æŠ•ç¸£' %}selected{% endif %}>å—æŠ•ç¸£</option>
      <option value="é›²æ—ç¸£"  {% if not has_des_custom and driver.destination == 'é›²æ—ç¸£' %}selected{% endif %}>é›²æ—ç¸£</option>
      <option value="å˜‰ç¾©å¸‚"  {% if not has_des_custom and driver.destination == 'å˜‰ç¾©å¸‚' %}selected{% endif %}>å˜‰ç¾©å¸‚</option>
      <option value="å˜‰ç¾©ç¸£"  {% if not has_des_custom and driver.destination == 'å˜‰ç¾©ç¸£' %}selected{% endif %}>å˜‰ç¾©ç¸£</option>
      <option value="å°å—å¸‚"  {% if not has_des_custom and driver.destination == 'å°å—å¸‚' %}selected{% endif %}>å°å—å¸‚</option>
      <option value="é«˜é›„å¸‚"  {% if not has_des_custom and driver.destination == 'é«˜é›„å¸‚' %}selected{% endif %}>é«˜é›„å¸‚</option>
      <option value="å±æ±ç¸£"  {% if not has_des_custom and driver.destination == 'å±æ±ç¸£' %}selected{% endif %}>å±æ±ç¸£</option>
      <option value="å®œè˜­ç¸£"  {% if not has_des_custom and driver.destination == 'å®œè˜­ç¸£' %}selected{% endif %}>å®œè˜­ç¸£</option>
      <option value="èŠ±è“®ç¸£"  {% if not has_des_custom and driver.destination == 'èŠ±è“®ç¸£' %}selected{% endif %}>èŠ±è“®ç¸£</option>
      <option value="å°æ±ç¸£"  {% if not has_des_custom and driver.destination == 'å°æ±ç¸£' %}selected{% endif %}>å°æ±ç¸£</option>
      <option value="æ¾æ¹–ç¸£"  {% if not has_des_custom and driver.destination == 'æ¾æ¹–ç¸£' %}selected{% endif %}>æ¾æ¹–ç¸£</option>
      <option value="é‡‘é–€ç¸£"  {% if not has_des_custom and driver.destination == 'é‡‘é–€ç¸£' %}selected{% endif %}>é‡‘é–€ç¸£</option>
      <option value="é€£æ±Ÿç¸£"  {% if not has_des_custom and driver.destination == 'é€£æ±Ÿç¸£' %}selected{% endif %}>é€£æ±Ÿç¸£</option>
    </select>
    <input type="text"
           id="customDestination"
           name="destination_custom"
           value="{{ driver.destination_custom|default:'' }}"
           style="display:{% if has_des_custom %}block{% else %}none{% endif %};"
           placeholder="è¼¸å…¥è‡ªè¨‚ç›®çš„åœ°" />
    {% endwith %}

    <label>é…Œæ”¶è²»ç”¨ï¼ˆé¸å¡«ï¼‰</label>
    <input type="text" name="fare_note" value="{{ driver.fare_note|default_if_none:'' }}" placeholder="ä¾‹å¦‚ï¼šæ¯äºº 200ã€æ²¹éŒ¢å‡æ”¤ã€è¦–é‡Œç¨‹è€Œå®šâ€¦" />

    <label class="required">å‡ºç™¼æ—¥æœŸ</label>
    <input type="date" name="date" id="driver-date" value="{{ driver.date|date:'Y-m-d' }}" required />

    <label>å›ç¨‹æ—¥æœŸï¼ˆé¸å¡«ï¼‰</label>
    <input type="date" name="return_date" id="driver-return" value="{{ driver.return_date|date:'Y-m-d' }}" />

    <label>é †è·¯æ¥é€æ„é¡˜</label>
    <select name="flexible_pickup">
      <option value="YES" {% if driver.flexible_pickup == 'YES' %}selected{% endif %}>é †è·¯å¯è¼‰</option>
      <option value="NO"  {% if driver.flexible_pickup == 'NO'  %}selected{% endif %}>ä¸é †è·¯ä¹ŸOK</option>
      <option value="MAYBE" {% if driver.flexible_pickup == 'MAYBE' %}selected{% endif %}>è¦–æƒ…æ³</option>
    </select>

    <div class="switch">
      <input type="checkbox" name="is_active" id="is_active" {% if driver.is_active %}checked{% endif %} />
      <span class="toggle"></span>
      <label for="is_active">æ˜¯å¦é–‹æ”¾ï¼ˆåº§ä½æ»¿æœƒè‡ªå‹•é—œé–‰ï¼‰</label>
    </div>

    <label>å‚™è¨»</label>
    <textarea name="note">{{ driver.note|default_if_none:'' }}</textarea>

    <button class="btn" type="submit">ğŸ’¾ å„²å­˜</button>
    <!-- âœ… å›é¦–é æŒ‰éˆ•ï¼ˆè¡¨å–®å¤–ï¼Œç´”é€£çµï¼Œä¸æœƒè§¸ç™¼æäº¤ï¼‰ -->
<div style="max-width:600px;margin:0 auto 8px;">
  <a href="{% url 'find_index' %}" class="btn-ghost" style="
     display:inline-block;text-decoration:none;text-align:center;
     width:96%;padding:12px;margin-top: 10px;border-radius:10px;font-weight:700;">
    ğŸ  å›é¦–é 
  </a>
</div>
  </form>
  <!-- B) åˆªé™¤å¸æ©Ÿï¼ˆç¨ç«‹ formï¼Œé¿å…èª¤è§¸é€åˆ°ä¸Šé¢ï¼‰ -->
  <form method="POST" action="{% url 'delete_driver' driver.id %}" style="max-width:600px;margin:14px auto 0;"
        onsubmit="return confirm('âš ï¸ ç¢ºå®šè¦å–æ¶ˆå‡ºè»Šå—ï¼Ÿç›¸é—œä¹˜å®¢ä¹Ÿæœƒè¢«è§£é™¤é—œè¯ï¼')">
    {% csrf_token %}
    <button class="btn btn-danger" type="submit">ğŸ—‘ï¸ å–æ¶ˆå‡ºè»Š</button>
  </form>

  <!-- C) å·²ç™»è¨˜ä¹˜å®¢ -->
  <div class="panel">
    <h3>ğŸ§ å¾…ç¢ºèª</h3>
    <ul class="pax-list">
      {% if pending %}
        {% for p in pending %}
          <li class="pax-item pax-pending">
            <div class="pax-row">
              <div class="pax-head">
                <span class="pax-name">{{ p.passenger_name }}</span>
                <span class="badge gender">{{ p.get_gender_display }}</span>
                {% if p.together_return is not None %}
                  <span class="badge rt">å›ç¨‹ï¼š{{ p.together_return|yesno:"ä¸€èµ·,ä¸ä¸€èµ·" }}</span>
                {% endif %}
              </div>
              <div class="pax-grid">
                <div class="pax-cell"><label>å‡ºç™¼åœ°</label><div>{{ p.departure|default:"æœªå¡«" }}</div></div>
                <div class="pax-cell"><label>ç›®çš„åœ°</label><div>{{ p.destination|default:"æœªå¡«" }}</div></div>
                <div class="pax-cell"><label>äººæ•¸</label><div>{{ p.seats_needed }}</div></div>
                <div class="pax-cell"><label>é¡˜ä»˜</label><div>{% if p.willing_to_pay %}NT$ {{ p.willing_to_pay|floatformat:0 }}{% else %}æœªå¡«{% endif %}</div></div>
                <div class="pax-cell"><label>æ—¥æœŸ</label><div>{{ p.date }}</div></div>
                <div class="pax-cell"><label>å›ç¨‹</label><div>{{ p.return_date|default:"æœªå®š" }}</div></div>
                <div class="pax-cell span-2"><label>è¯çµ¡æ–¹å¼</label><div>{{ p.contact|default:"æœªå¡«" }}</div></div>
              </div>
              {% if p.note %}<div class="pax-note">å‚™è¨»ï¼š{{ p.note }}</div>{% endif %}
              <div class="pax-actions">
                <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
                <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
              </div>
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="pax-item">ç›®å‰æ²’æœ‰å¾…ç¢ºèªä¹˜å®¢</li>
      {% endif %}
    </ul>

    <h3 style="margin-top:18px;">âœ… å·²æ¥å—</h3>
    <ul class="pax-list">
      {% if accepted %}
        {% for p in accepted %}
          <li class="pax-item pax-accepted">
            <div class="pax-row">
              <div class="pax-head">
                <span class="pax-name">âœ” {{ p.passenger_name }}</span>
                <span class="badge gender">{{ p.get_gender_display }}</span>
              </div>
              <div class="pax-grid">
                <div class="pax-cell"><label>å‡ºç™¼åœ°</label><div>{{ p.departure }}</div></div>
                <div class="pax-cell"><label>äººæ•¸</label><div>{{ p.seats_needed }}</div></div>
                <div class="pax-cell span-2"><label>è¯çµ¡æ–¹å¼</label><div>{{ p.contact|default:"æœªå¡«" }}</div></div>
              </div>
              <div class="pax-actions">
                <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
                <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
              </div>
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="pax-item">å°šç„¡å·²æ¥å—ä¹˜å®¢</li>
      {% endif %}
    </ul>
  </div>

  <script>
    // å‡ºç™¼åœ°ç‚ºã€Œè‡ªå¡«ã€æ™‚é¡¯ç¤ºè‡ªè¨‚è¼¸å…¥æ¡†
    function checkCustomDeparture(select){
      const customInput = document.getElementById('customDeparture');
      if (!customInput) return;
      const show = (select.value === 'è‡ªå¡«');
      customInput.style.display = show ? 'block' : 'none';
      customInput.required = show;
      if (!show) customInput.value = '';
    }
    // ç›®çš„åœ°ç‚ºã€Œè‡ªå¡«ã€æ™‚é¡¯ç¤ºè‡ªè¨‚è¼¸å…¥æ¡†
    function checkCustomDestination(select){
      const input = document.getElementById('customDestination');
      if (!input) return;
      const show = (select.value === 'è‡ªå¡«');
      input.style.display = show ? 'block' : 'none';
      input.required = show;
      if (!show) input.value = '';
    }

    // æ—¥æœŸå‰ç«¯é˜²å‘†ï¼šå‡ºç™¼ >= ä»Šå¤©ï¼›å›ç¨‹ >= max(ä»Šå¤©, å‡ºç™¼) æˆ–ç‚ºç©º
    document.addEventListener('DOMContentLoaded', () => {
      const dep = document.getElementById('driver-date');
      const ret = document.getElementById('driver-return');
      const today = new Date().toISOString().split('T')[0];
      if (!dep || !ret) return;

      function syncMin(){
        dep.min = today;
        ret.min = dep.value || today;
        if (ret.value && ret.value < ret.min) ret.value = '';
      }
      dep.addEventListener('change', syncMin);
      ret.addEventListener('change', syncMin);
      syncMin();
    });

    // é€²é åˆå§‹åŒ–ï¼ˆè‹¥é è¨­å°±é¸åˆ°è‡ªå¡«è¦å±•é–‹ï¼‰
    (function(){
      const depSel = document.getElementById('departure');
      const desSel = document.getElementById('destination');
      if (depSel) checkCustomDeparture(depSel);
      if (desSel) checkCustomDestination(desSel);
    })();
  </script>
  <script>
(function () {
  const elActive = document.getElementById('is_active');
  const elToggle = document.querySelector('.switch .toggle');
  const elLabel  = document.querySelector('.switch label');
  if (!elActive || !elToggle || !elLabel) return;

  // å»ºç«‹/å–å¾—æç¤ºç¯€é» <span class="hint" id="active-hint">
  let hint = document.getElementById('active-hint');
  if (!hint) {
    hint = document.createElement('span');
    hint.id = 'active-hint';
    hint.className = 'hint';
    // ç½®æ–¼ label ä¸‹é¢ï¼ˆå’Œä½ çš„çµæ§‹å…¼å®¹ï¼‰
    elLabel.insertAdjacentElement('afterend', hint);
  }

  // å–å¾— seats_filledï¼šç”¨ hidden æˆ– data ä»»ä¸€ï¼›å…©è€…éƒ½æ²’æœ‰å°± 0
  function getFilled() {
    const h = document.getElementById('seats_filled_val');
    if (h && h.value !== undefined) {
      const n = parseInt(h.value, 10);
      return Number.isFinite(n) ? n : 0;
    }
    const meta = document.getElementById('driver-meta'); // <div id="driver-meta" data-seats-filled="3">
    if (meta && meta.dataset && meta.dataset.seatsFilled !== undefined) {
      const n = parseInt(meta.dataset.seatsFilled, 10);
      return Number.isFinite(n) ? n : 0;
    }
    return 0;
  }

  // ç¸½åº§ä½æ¬„ä½ï¼ˆç”¨ä¾†å³æ™‚åˆ¤æ–·æ˜¯å¦å¯é–‹æ”¾ï¼‰
  const elTotal = document.getElementById('seats_total');

  function setHint(text, tone){
    hint.textContent = text || '';
    hint.style.color = (tone === 'warn') ? '#9a6b00'
                    : (tone === 'ok')   ? '#206b3a'
                    : '#6b7280';
  }

  function refreshLock() {
    const filled = getFilled();
    const total  = parseInt(elTotal && elTotal.value, 10);
    const totalSafe = Number.isFinite(total) ? Math.max(1, total) : 1;

    if (filled >= totalSafe) {
      // æ»¿åº§ â†’ å¼·åˆ¶é—œé–‰ä¸”é–ä½
      elActive.checked = false;
      elActive.disabled = true;
      elToggle.style.opacity = .6;
      elToggle.style.cursor = 'not-allowed';
      setHint(`åº§ä½å·²æ»¿ï¼ˆ${filled}/${totalSafe}ï¼‰ï¼Œå·²è‡ªå‹•é—œé–‰`, 'warn');
      elActive.title = 'åº§ä½å·²æ»¿æ™‚ä¸å¯é–‹æ”¾';
    } else {
      // å¯åˆ‡æ›
      elActive.disabled = false;
      elToggle.style.opacity = 1;
      elToggle.style.cursor = 'pointer';
      elActive.title = '';
      setHint(elActive.checked ? 'ç›®å‰ç‹€æ…‹ï¼šå·²é–‹æ”¾' : 'ç›®å‰ç‹€æ…‹ï¼šæœªé–‹æ”¾', elActive.checked ? 'ok' : '');
    }
  }

  // è®“é»æ“Šç¶ è‰²æ»‘æ¡¿ä¹Ÿèƒ½åˆ‡æ›
  elToggle.addEventListener('click', () => {
    if (elActive.disabled) return;
    elActive.checked = !elActive.checked;
    refreshLock();
  });

  elActive.addEventListener('change', refreshLock);

  if (elTotal) {
    elTotal.addEventListener('input', refreshLock);
    elTotal.addEventListener('change', refreshLock);
  }

  // åˆå§‹è·‘ä¸€æ¬¡
  refreshLock();
})();
</script>

</body>
</html>
