{# templates/Find/_driver_list.html #}
{% for d in drivers %}
  {% if d.is_active %}
    <li class="card driver-card" data-driver="{{ d.id }}">
      <div class="driver-grid">
        <!-- å·¦ï¼šæš±ç¨± - åº§ä½ï¼ˆç½®ä¸­ï¼‰ -->
        <div class="col-left">
          <div class="name-seat">
            <b>{{ d.driver_name }}</b> - åº§ä½ï¼š{{ d.seats_filled }}/{{ d.seats_total }}
          </div>
        </div>

        <!-- ä¸­ï¼šä¸‰è¡Œè³‡è¨Š -->
        <div class="col-middle">
          <div class="line line1">{{ d.departure }} â†’ {{ d.destination }}</div>
          <div class="line line2">
            å‡ºç™¼ï¼š{{ d.date }}ã€€|ã€€å›ç¨‹ï¼š{{ d.return_date|default:"æœªå®š" }}
          </div>
          <div class="line line3">
            é †è·¯æ¥é€ï¼š
            {% if d.flexible_pickup == "YES" %}é †è·¯å¯è¼‰
            {% elif d.flexible_pickup == "NO" %}ä¸é †è·¯ä¹ŸOK
            {% else %}è¦–æƒ…æ³{% endif %}
          </div>
        </div>

        <!-- å³ï¼šæŒ‰éˆ•èˆ‡ç®­é ­ -->
        <div class="col-actions">
          <button type="button" class="btn-manage"
                  data-action="manage" data-id="{{ d.id }}"
                  onclick="window.__handleAction(event)">
            ç®¡ç†
          </button>

          <button type="button" class="btn-join"
                  data-action="join" data-id="{{ d.id }}"
                  onclick="window.__handleAction(event)">
            åƒåŠ 
          </button>

          <button type="button" id="arrow-{{ d.id }}" class="arrow"
                  data-action="toggle" data-id="{{ d.id }}"
                  aria-controls="details-{{ d.id }}" aria-expanded="false"
                  title="å±•é–‹/æ”¶åˆ"
                  onclick="window.__handleAction(event)">â–¶</button>
        </div>

        <!-- è©³ç´°å€å¡Š -->
        <div id="details-{{ d.id }}" class="details" aria-hidden="true">
  <h4>ğŸš— å¸æ©Ÿè³‡è¨Š</h4>
  <p><b>æš±ç¨±ï¼š</b>{{ d.driver_name }}</p>
  <p><b>æ€§åˆ¥ï¼š</b>{{ d.get_gender_display }}</p>
  <p><b>Emailï¼š</b>{{ d.email|default:"æœªæä¾›" }}</p>
  <p><b>è¯çµ¡æ–¹å¼ï¼š</b>{{ d.contact }}</p>
  <p><b>å‡ºç™¼æ—¥æœŸï¼š</b>{{ d.date }}</p>
  <p><b>å›ç¨‹æ—¥æœŸï¼š</b>{{ d.return_date|default:"æœªå®š" }}</p>
  <p><b>é †è·¯æ¥é€æ„é¡˜ï¼š</b>
    {% if d.flexible_pickup == "YES" %}é †è·¯å¯è¼‰
    {% elif d.flexible_pickup == "NO" %}ä¸é †è·¯ä¹ŸOK
    {% else %}è¦–æƒ…æ³{% endif %}
  </p>
  <p><b>å‚™è¨»ï¼š</b>{{ d.note|default:"ç„¡" }}</p>

  {# --- å·²ç™»è¨˜ä¹˜å®¢ï¼ˆåˆ†å¾…ç¢ºèª / å·²æ¥å—ï¼‰ --- #}
{% with items=d.passengers.all %}

  <h4>ğŸ§ å¾…ç¢ºèªä¹˜å®¢</h4>
  <ul class="pax-list">
    {% for p in items %}
      {% if not p.is_matched %}
        <li class="pax-item pax-pending">
          <span class="pax-name">{{ p.passenger_name }}</span>
          <span class="pax-meta">
            {{ p.get_gender_display }}ãƒ»å‡ºç™¼ï¼š{{ p.departure }}ãƒ»äººæ•¸ï¼š{{ p.seats_needed }}
          </span>
          <span class="pax-actions">
            <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
            <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
          </span>
        </li>
      {% endif %}
    {% empty %}
      <li class="pax-empty">ç›®å‰æ²’æœ‰ä»»ä½•ä¹˜å®¢</li>
    {% endfor %}
  </ul>

  <h4>âœ… å·²æ¥å—ä¹˜å®¢</h4>
  <ul class="pax-list">
    {% for p in items %}
      {% if p.is_matched %}
        <li class="pax-item pax-accepted">
          <span class="check">âœ”</span>
          <span class="pax-name">{{ p.passenger_name }}</span>
          <span class="pax-meta">
            {{ p.get_gender_display }}ãƒ»å‡ºç™¼ï¼š{{ p.departure }}ãƒ»äººæ•¸ï¼š{{ p.seats_needed }}
          </span>
          <span class="pax-actions">
            <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
            <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
          </span>
        </li>
      {% endif %}
    {% empty %}
      <li class="pax-empty">å°šç„¡å·²æ¥å—ä¹˜å®¢</li>
    {% endfor %}
  </ul>

{% endwith %}
        </div>