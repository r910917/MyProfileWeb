<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å¸æ©Ÿç®¡ç†</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; background:#f7fbff; margin:0; padding:20px; }
    h2 { color:#005c4b; margin: 10px 0 6px; }
    .wrap { max-width: 1000px; margin: 0 auto; }
    .section { background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.06); padding:16px 18px; margin:16px 0; }
    label { display:block; font-weight:bold; margin:10px 0 6px; }
    input, select, textarea {
      width:100%; padding:10px; border-radius:8px; border:1px solid #d7dde5; background:#fcfdff;
    }
    .row { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; }
    .row-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    .actions { display:flex; gap:10px; margin-top:12px; }
    button {
      padding:10px 16px; border:none; border-radius:8px; color:#fff; cursor:pointer; font-weight:bold;
      background:#007bff;
    }
    button.secondary { background:#28a745; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; margin-left:8px; }
    .pill.on { background:#e3f7ec; color:#1f7a3b; border:1px solid #a7e2bf; }
    .pill.off{ background:#fdeeee; color:#a63f3f; border:1px solid #f3b6b6; }
    .note { font-size: 12px; color:#666; }
    .msg { margin:8px 0; padding:10px 12px; border-radius:8px; font-weight:bold; }
    .msg.ok { background:#e8f8ef; color:#206b3a; }
    .msg.warn { background:#fff7e6; color:#9a6b00; }
    .msg.err { background:#ffefef; color:#9a2a2a; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
    .table th { background:#f6f9fc; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>å¸æ©Ÿç®¡ç†ï¼š{{ driver.driver_name }}
      {% if driver.is_active %}
        <span class="pill on">ä¸Šæ¶ä¸­</span>
      {% else %}
        <span class="pill off">æœªä¸Šæ¶</span>
      {% endif %}
    </h2>
    <p class="note">è·¯ç·šï¼š{{ driver.departure }} â†’ {{ driver.destination }}ã€€ï½œã€€åº§ä½ï¼š{{ driver.seats_filled }} / {{ driver.seats_total }}</p>

    {% if saved_msg %}<div class="msg ok">{{ saved_msg }}</div>{% endif %}
    {% if matched_msg %}<div class="msg ok">{{ matched_msg }}</div>{% endif %}
    {% if full_msg %}<div class="msg warn">{{ full_msg }}</div>{% endif %}

    <!-- ä¸ŠåŠï¼šç·¨è¼¯å¸æ©Ÿ -->
    <div class="section">
      <h3>ğŸ› ï¸ ç·¨è¼¯å¸æ©Ÿè³‡æ–™</h3>
      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="form" value="update_driver">
        <div class="row">
          <div>
            <label>æš±ç¨±</label>
            <input type="text" name="driver_name" value="{{ driver.driver_name }}" required>
          </div>
          <div>
            <label>æ€§åˆ¥</label>
            <select name="gender">
              <option value="M" {% if driver.gender == "M" %}selected{% endif %}>ç”·ç”Ÿ</option>
              <option value="F" {% if driver.gender == "F" %}selected{% endif %}>å¥³ç”Ÿ</option>
              <option value="X" {% if driver.gender == "X" %}selected{% endif %}>ä¸æ–¹ä¾¿é€æ¼</option>
            </select>
          </div>
          <div>
            <label>Emailï¼ˆå¯ç•™ç©ºï¼‰</label>
            <input type="email" name="email" value="{{ driver.email|default_if_none:'' }}">
          </div>
          <div>
            <label>è¯çµ¡æ–¹å¼</label>
            <input type="text" name="contact" value="{{ driver.contact }}" placeholder="LINE ID / IG / Phone Number" required>
          </div>
          <div>
            <label>ç®¡ç†å¯†ç¢¼ï¼ˆç•™ç©ºå‰‡ä¸è®Šæ›´ï¼‰</label>
            <input type="password" name="password" placeholder="ç•™ç©ºä¸ä¿®æ”¹">
          </div>
          <div>
            <label>ç¸½åº§ä½</label>
            <input type="number" name="seats_total" min="1" value="{{ driver.seats_total }}" required>
          </div>
        </div>

        <div class="row-3" style="margin-top:10px;">
          <div>
            <label>å‡ºç™¼åœ°</label>
            <input type="text" name="departure" value="{{ driver.departure }}" required>
          </div>
          <div>
            <label>ç›®çš„åœ°</label>
            <input type="text" name="destination" value="{{ driver.destination }}" required>
          </div>
          <div>
            <label>å‡ºç™¼æ—¥æœŸ</label>
            <input type="date" name="date" value="{{ driver.date|date:'Y-m-d' }}" required>
          </div>
          <div>
            <label>å›ç¨‹æ—¥æœŸï¼ˆå¯ç•™ç©ºï¼‰</label>
            <input type="date" name="return_date" value="{{ driver.return_date|date:'Y-m-d' }}">
          </div>
          <div>
            <label>é †è·¯æ¥é€æ„é¡˜</label>
            <select name="flexible_pickup">
              <option value="YES" {% if driver.flexible_pickup == "YES" %}selected{% endif %}>é †è·¯å¯è¼‰</option>
              <option value="NO"  {% if driver.flexible_pickup == "NO"  %}selected{% endif %}>ä¸é †è·¯ä¹ŸOK</option>
              <option value="MAYBE" {% if driver.flexible_pickup == "MAYBE" %}selected{% endif %}>è¦–æƒ…æ³</option>
            </select>
          </div>
          <div>
            <label>æ˜¯å¦ä¸Šæ¶</label>
            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
              <input type="checkbox" name="is_active" id="is_active" {% if driver.is_active %}checked{% endif %}>
              <label for="is_active" style="margin:0;font-weight:normal;">ä¸Šæ¶ï¼ˆåº§ä½æ»¿æœƒè‡ªå‹•ä¸‹æ¶ï¼‰</label>
            </div>
          </div>
        </div>

        <label style="margin-top:12px;">å‚™è¨»</label>
        <textarea name="note" rows="3" placeholder="è£œå……èªªæ˜">{{ driver.note }}</textarea>

        <div class="actions">
          <button type="submit">ğŸ’¾ å„²å­˜</button>
          <a href="{% url 'find_index' %}" style="text-decoration:none;">
            <button type="button" class="secondary">ğŸ  å›é¦–é </button>
          </a>
        </div>
      </form>
    </div>

    <!-- ä¸‹åŠï¼šå€™é¸ä¹˜å®¢ -->
    <div class="section">
      <h3>ğŸ§ å€™é¸ä¹˜å®¢ï¼ˆåŒè·¯ç·šåŒæ—¥æœŸãƒ»å°šæœªåª’åˆï¼‰</h3>
      {% if candidates %}
        <form method="POST">
          {% csrf_token %}
          <input type="hidden" name="form" value="accept_passengers">
          <table class="table">
            <thead>
              <tr>
                <th style="width:40px;"></th>
                <th>æš±ç¨± / æ€§åˆ¥</th>
                <th>Emailï¼ˆéš±è—ä¸é¡¯ç¤ºï¼‰</th>
                <th>è¯çµ¡æ–¹å¼</th>
                <th>äººæ•¸</th>
                <th>é¡˜ä»˜è²»ç”¨</th>
                <th>å‡ºç™¼åœ°</th>
                <th>ç›®çš„åœ°</th>
                <th>æ˜¯å¦ä¸€èµ·å›ç¨‹</th>
                <th>å‚™è¨»</th>
              </tr>
            </thead>
            <tbody>
              {% for p in candidates %}
                <tr>
                  <td>
                    <input type="checkbox" name="accept_ids" value="{{ p.id }}">
                  </td>
                  <td>{{ p.passenger_name }}ï¼ˆ{{ p.get_gender_display }}ï¼‰</td>
                  <td>ç³»çµ±ç”¨</td>
                  <td>{{ p.contact }}</td>
                  <td>{{ p.seats_needed }}</td>
                  <td>
                    {% if p.willing_to_pay %}{{ p.willing_to_pay }}{% else %}-{% endif %}
                  </td>
                  <td>{{ p.departure }}</td>
                  <td>{{ p.destination }}</td>
                  <td>
                    {% if p.return_date %}æ˜¯{% else %}å¦ / æœªå®š{% endif %}
                  </td>
                  <td>{{ p.note|default:"â€”" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

          <div class="actions">
            <button type="submit" class="secondary">âœ… æ¥å—å‹¾é¸ä¹˜å®¢</button>
          </div>
        </form>
      {% else %}
        <p class="note">ç›®å‰æ²’æœ‰å€™é¸ä¹˜å®¢ã€‚</p>
      {% endif %}
    </div>
  </div>
</body>
</html>
