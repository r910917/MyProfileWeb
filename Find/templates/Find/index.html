<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ èŠ±è“®å…‰å¾©æ•‘ç½äº¤é€šåª’åˆ</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to right, #eaf8ff, #f7fff7);
      color: #222;
    }

    h1 {
      text-align: center;
      padding: 20px;
      color: #005c4b;
    }

    .buttons {
      text-align: center;
      margin: 10px 0 20px;
    }

    .btn-main {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin: 0 5px;
      color: white;
      font-weight: bold;
      transition: transform 0.2s, background 0.3s;
    }
    .btn-driver {
      background: #007bff;
    }
    .btn-driver:hover {
      background: #0056b3;
      transform: scale(1.05);
    }
    .btn-passenger {
      background: #dc3545;
    }
    .btn-passenger:hover {
      background: #a71d2a;
      transform: scale(1.05);
    }

    h2 {
      color: #00695c;
      margin-left: 20px;
    }

    .card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #fff;
      margin: 10px 20px;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      animation: fadeInUp 0.4s ease-in-out;
    }

    .card::before {
      content: "";
      display: block;
      width: 6px;
      height: 100%;
      border-radius: 6px 0 0 6px;
      margin-right: 10px;
    }

    .driver-card::before {
      background: #2196f3;
    }
    .passenger-card::before {
      background: #f44336;
    }

    .actions button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      background: #007bff;
      margin-left: 5px;
      transition: background 0.3s;
    }
    .actions button:hover {
      background: #0056b3;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
    }
    .modal-content {
      background: white;
      margin: 15% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }
    .close {
      float: right;
      font-size: 20px;
      cursor: pointer;
    }

    /* å‹•ç•« */
    @keyframes fadeInUp {
      from {opacity: 0; transform: translateY(15px);}
      to {opacity: 1; transform: translateY(0);}
    }

    /* å›åˆ°é ‚ç«¯æŒ‰éˆ• */
    #backToTop {
      position: fixed;
      bottom: 20px; right: 20px;
      background: #00897b;
      color: #fff;
      border: none;
      border-radius: 50%;
      padding: 14px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 1200;
      transition: transform 0.2s, background 0.3s;
    }
    #backToTop:hover {
      background: #00695c;
      transform: scale(1.08);
    }
  </style>
</head>
<body>
  <h1>ğŸŒ èŠ±è“®å…‰å¾©æ•‘ç½äº¤é€šåª’åˆ</h1>

  <div class="buttons">
    <a href="{% url 'find_car' %}">
      <button class="btn-main btn-driver">ğŸš— æˆ‘è¦å‡ºè»Šï¼ˆæ‰¾ä¹˜å®¢ï¼‰</button>
    </a>
    <a href="{% url 'find_people' %}">
      <button class="btn-main btn-passenger">ğŸ§ æˆ‘è¦æ­è»Šï¼ˆæ‰¾è»Šï¼‰</button>
    </a>
  </div>

  <h2>æ‰¾è»Šéœ€æ±‚ï¼ˆä¹˜å®¢éœ€è¦å¸æ©Ÿï¼‰</h2>
  <ul id="passenger-list">
    {% for p in passengers %}
      {% if not p.is_matched %}
        <li class="card passenger-card">
          <span><b>{{ p.passenger_name }}</b> - éœ€è¦ {{ p.seats_needed }} äºº
            ({{ p.departure }} â†’ {{ p.destination }}, {{ p.date }})</span>
          <div class="actions">
            <button onclick="openPassengerModal('{{ p.id }}')">ç·¨è¼¯</button>
            <button onclick="openJoinModal('{{ p.id }}')">åƒåŠ </button>
          </div>
        </li>
      {% endif %}
    {% empty %}
      <li class="card passenger-card">ç›®å‰æ²’æœ‰éœ€æ±‚</li>
    {% endfor %}
  </ul>

  <h2>æ‰¾äººè³‡è¨Šï¼ˆå¸æ©Ÿæä¾›åº§ä½ï¼‰</h2>
  <ul id="driver-list">
    {% for d in drivers %}
      {% if d.is_active %}
        <li class="card driver-card">
          <span><b>{{ d.driver_name }}</b> - åº§ä½ï¼š{{ d.seats_filled }} / {{ d.seats_total }}
            ({{ d.departure }} â†’ {{ d.destination }}, {{ d.date }})</span>
          <div class="actions">
            <button onclick="openDriverModal('{{ d.id }}')">ç®¡ç†</button>
          </div>
        </li>
      {% endif %}
    {% empty %}
      <li class="card driver-card">ç›®å‰æ²’æœ‰è»Šè¼›</li>
    {% endfor %}
  </ul>

  <!-- å›åˆ°é ‚ç«¯ -->
  <button id="backToTop" onclick="window.scrollTo({top:0, behavior:'smooth'});">â¬†</button>

  <script>
    // WebSocket è‡ªå‹•æ›´æ–°
    const socket = new WebSocket("ws://" + window.location.host + "/ws/find/");

    socket.onopen = function() {
      console.log("âœ… WebSocket é€£ç·šæˆåŠŸ");
    };

    socket.onmessage = function(event) {
      try {
        const data = JSON.parse(event.data);
        console.log("ğŸ“© æ”¶åˆ°è³‡æ–™ï¼š", data);

        if (data.type === "update") {
          if (data.passengers_html) {
            document.getElementById("passenger-list").innerHTML = data.passengers_html;
          }
          if (data.drivers_html) {
            document.getElementById("driver-list").innerHTML = data.drivers_html;
          }
        }
      } catch (err) {
        console.error("âš ï¸ è§£æè¨Šæ¯å¤±æ•—", err, event.data);
      }
    };

    socket.onclose = function() {
      console.log("âŒ WebSocket å·²é—œé–‰");
    };

    socket.onerror = function(error) {
      console.error("âš ï¸ WebSocket ç™¼ç”ŸéŒ¯èª¤", error);
    };
  </script>
</body>
</html>
