<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å¸æ©Ÿç®¡ç†</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; background:#f7fbff; margin:0; padding:20px; }
    h2 { color:#005c4b; margin: 10px 0 6px; }
    .wrap { max-width: 1000px; margin: 0 auto; }
    .section { background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.06); padding:16px 18px; margin:16px 0; }
    label { display:block; font-weight:bold; margin:10px 0 6px; }
    input, select, textarea {
      width:100%; padding:10px; border-radius:8px; border:1px solid #d7dde5; background:#fcfdff;
    }
    .row { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; }
    .row-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    .actions { display:flex; gap:10px; margin-top:12px; }
    button {
      padding:10px 16px; border:none; border-radius:8px; color:#fff; cursor:pointer; font-weight:bold;
      background:#007bff;
    }
    button.secondary { background:#28a745; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; margin-left:8px; }
    .pill.on { background:#e3f7ec; color:#1f7a3b; border:1px solid #a7e2bf; }
    .pill.off{ background:#fdeeee; color:#a63f3f; border:1px solid #f3b6b6; }
    .note { font-size: 12px; color:#666; }
    .msg { margin:8px 0; padding:10px 12px; border-radius:8px; font-weight:bold; }
    .msg.ok { background:#e8f8ef; color:#206b3a; }
    .msg.warn { background:#fff7e6; color:#9a6b00; }
    .msg.err { background:#ffefef; color:#9a2a2a; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
    .table th { background:#f6f9fc; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>å¸æ©Ÿç®¡ç†ï¼š{{ driver.driver_name }}
      {% if driver.is_active %}
        <span class="pill on">ä¸Šæ¶ä¸­</span>
      {% else %}
        <span class="pill off">æœªä¸Šæ¶</span>
      {% endif %}
    </h2>
    <p class="note">è·¯ç·šï¼š{{ driver.departure }} â†’ {{ driver.destination }}ã€€ï½œã€€åº§ä½ï¼š{{ driver.seats_filled }} / {{ driver.seats_total }}</p>

    {% if saved_msg %}<div class="msg ok">{{ saved_msg }}</div>{% endif %}
    {% if matched_msg %}<div class="msg ok">{{ matched_msg }}</div>{% endif %}
    {% if full_msg %}<div class="msg warn">{{ full_msg }}</div>{% endif %}

    <!-- ä¸ŠåŠï¼šç·¨è¼¯å¸æ©Ÿ -->
    <div class="section">
      <h3>ğŸ› ï¸ ç·¨è¼¯å¸æ©Ÿè³‡æ–™</h3>
      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="form" value="update_driver">
        <div class="row">
          <div>
            <label>æš±ç¨±</label>
            <input type="text" name="driver_name" value="{{ driver.driver_name }}" required>
          </div>
          <div>
            <label>æ€§åˆ¥</label>
            <select name="gender">
              <option value="M" {% if driver.gender == "M" %}selected{% endif %}>ç”·ç”Ÿ</option>
              <option value="F" {% if driver.gender == "F" %}selected{% endif %}>å¥³ç”Ÿ</option>
              <option value="X" {% if driver.gender == "X" %}selected{% endif %}>ä¸æ–¹ä¾¿é€æ¼</option>
            </select>
          </div>
          <div>
            <label>Emailï¼ˆå¯ç•™ç©ºï¼‰</label>
            <input type="email" name="email" value="{{ driver.email|default_if_none:'' }}">
          </div>
          <div>
            <label>è¯çµ¡æ–¹å¼</label>
            <input type="text" name="contact" value="{{ driver.contact }}" placeholder="LINE ID / IG / Phone Number" required>
          </div>
          <div>
            <label>ç®¡ç†å¯†ç¢¼ï¼ˆç•™ç©ºå‰‡ä¸è®Šæ›´ï¼‰</label>
            <input type="password" name="password" placeholder="ç•™ç©ºä¸ä¿®æ”¹">
          </div>
          <div>
            <label>ç¸½åº§ä½</label>
            <input type="number" name="seats_total" min="1" value="{{ driver.seats_total }}" required>
          </div>
        </div>

        <div class="row-3" style="margin-top:10px;">
          <div>
            <label>å‡ºç™¼åœ°</label>
            <input type="text" name="departure" value="{{ driver.departure }}" required>
          </div>
          <div>
            <label>ç›®çš„åœ°</label>
            <input type="text" name="destination" value="{{ driver.destination }}" required>
          </div>
          <div>
            <label>å‡ºç™¼æ—¥æœŸ</label>
            <input type="date" name="date" value="{{ driver.date|date:'Y-m-d' }}" required>
          </div>
          <div>
            <label>å›ç¨‹æ—¥æœŸï¼ˆå¯ç•™ç©ºï¼‰</label>
            <input type="date" name="return_date" value="{{ driver.return_date|date:'Y-m-d' }}">
          </div>
          <div>
            <label>é †è·¯æ¥é€æ„é¡˜</label>
            <select name="flexible_pickup">
              <option value="YES" {% if driver.flexible_pickup == "YES" %}selected{% endif %}>é †è·¯å¯è¼‰</option>
              <option value="NO"  {% if driver.flexible_pickup == "NO"  %}selected{% endif %}>ä¸é †è·¯ä¹ŸOK</option>
              <option value="MAYBE" {% if driver.flexible_pickup == "MAYBE" %}selected{% endif %}>è¦–æƒ…æ³</option>
            </select>
          </div>
          <div>
            <label>æ˜¯å¦ä¸Šæ¶</label>
            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
              <input type="checkbox" name="is_active" id="is_active" {% if driver.is_active %}checked{% endif %}>
              <label for="is_active" style="margin:0;font-weight:normal;">ä¸Šæ¶ï¼ˆåº§ä½æ»¿æœƒè‡ªå‹•ä¸‹æ¶ï¼‰</label>
            </div>
          </div>
        </div>

        <label style="margin-top:12px;">å‚™è¨»</label>
        <textarea name="note" rows="3" placeholder="è£œå……èªªæ˜">{{ driver.note }}</textarea>

        <div class="actions">
          <button type="submit">ğŸ’¾ å„²å­˜</button>
          <a href="{% url 'find_index' %}" style="text-decoration:none;">
            <button type="button" class="secondary">ğŸ  å›é¦–é </button>
          </a>
        </div>
      </form>
    </div>

    <h4>ğŸ§ å·²ç™»è¨˜ä¹˜å®¢</h4>

<h5>å¾…ç¢ºèª</h5>
<ul class="pax-list">
  {% if pending %}
    {% for p in pending %}
      <li class="pax-item pax-pending">
        <div class="pax-row">
          <!-- æ¨™é¡Œåˆ— -->
          <div class="pax-head">
            <span class="pax-name">{{ p.passenger_name }}</span>
            <span class="badge gender">{{ p.get_gender_display }}</span>
            {% if p.together_return is not None %}
              <span class="badge rt">å›ç¨‹ï¼š{{ p.together_return|yesno:"ä¸€èµ·,ä¸ä¸€èµ·" }}</span>
            {% endif %}
          </div>

          <!-- é‡é»æ¬„ï¼ˆå¤šæ¬„ï¼‰ -->
          <div class="pax-grid">
            <div class="pax-cell"><label>å‡ºç™¼åœ°</label><div>{{ p.departure|default:"æœªå¡«" }}</div></div>
            <div class="pax-cell"><label>ç›®çš„åœ°</label><div>{{ p.destination|default:"æœªå¡«" }}</div></div>
            <div class="pax-cell"><label>äººæ•¸</label><div>{{ p.seats_needed }}</div></div>
            <div class="pax-cell">
              <label>é¡˜ä»˜</label>
              <div>{% if p.willing_to_pay %}NT$ {{ p.willing_to_pay|floatformat:0 }}{% else %}æœªå¡«{% endif %}</div>
            </div>
            <div class="pax-cell"><label>æ—¥æœŸ</label><div>{{ p.date }}</div></div>
            <div class="pax-cell"><label>å›ç¨‹</label><div>{{ p.return_date|default:"æœªå®š" }}</div></div>
            <div class="pax-cell span-2"><label>è¯çµ¡æ–¹å¼</label><div>{{ p.contact|default:"æœªå¡«" }}</div></div>
          </div>

          {% if p.note %}
            <div class="pax-note">å‚™è¨»ï¼š{{ p.note }}</div>
          {% endif %}

          <!-- æ“ä½œ -->
          <div class="pax-actions">
            <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
            <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
          </div>
        </div>
      </li>
    {% endfor %}
  {% else %}
    <li class="pax-empty">ç›®å‰æ²’æœ‰å¾…ç¢ºèªä¹˜å®¢</li>
  {% endif %}
</ul>

<h5>å·²æ¥å—</h5>
<ul class="pax-list">
  {% if accepted %}
    {% for p in accepted %}
      <li class="pax-item pax-accepted">
        <span class="check">âœ”</span>
        <span class="pax-name">{{ p.passenger_name }}</span>
        <span class="pax-meta">
          {{ p.get_gender_display }}ãƒ»å‡ºç™¼ï¼š{{ p.departure }}ãƒ»äººæ•¸ï¼š{{ p.seats_needed }}
        </span>
        <span class="pax-actions">
          <button class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
          <button class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
        </span>
      </li>
    {% endfor %}
  {% else %}
    <li class="pax-empty">å°šç„¡å·²æ¥å—ä¹˜å®¢</li>
  {% endif %}
</ul>
<style>

/* åˆ—è¡¨ & é …ç›® */
.pax-list{list-style:none;margin:10px 0 0;padding:0}
.pax-item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;margin:10px 0}
.pax-row{display:grid;grid-template-columns:1fr auto;grid-row-gap:10px;align-items:start}

/* æ¨™é¡Œåˆ— */
.pax-head{grid-column:1/-1;display:flex;align-items:center;gap:8px}
.pax-name{font-weight:700;font-size:15px}
.badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#4338ca}
.badge.gender{background:#e0f2fe;color:#0369a1}
.badge.rt{background:#fef3c7;color:#92400e}

/* é‡é»æ¬„ï¼ˆå¤šæ¬„ï¼‰ */
.pax-grid{
  grid-column:1/-1;
  display:grid;
  grid-template-columns:repeat(6,minmax(0,1fr)); /* æ¡Œæ©Ÿ 6 æ¬„ */
  gap:10px 14px;
}
.pax-cell label{
  display:block;font-size:12px;color:#6b7280;margin-bottom:4px;letter-spacing:.02em
}
.pax-cell div{font-size:14px;color:#111827}
.pax-cell.span-2{grid-column:span 2}

/* å‚™è¨» */
.pax-note{grid-column:1/-1;background:#f9fafb;border-radius:10px;padding:8px 10px;font-size:13px;color:#374151}

/* æ“ä½œæŒ‰éˆ• */
.pax-actions{display:flex;gap:8px;align-self:center}
.btn-mini{border:0;border-radius:8px;padding:7px 12px;background:#e5e7eb;cursor:pointer;font-weight:600}
.btn-mini:hover{background:#d1d5db}
.btn-mini.danger{background:#fecaca;color:#7f1d1d}
.btn-mini.danger:hover{background:#fca5a5}

/* æ‰‹æ©Ÿï¼å¹³æ¿ RWD */
@media (max-width:1024px){
  .pax-grid{grid-template-columns:repeat(4,minmax(0,1fr))} /* 4 æ¬„ */
}
@media (max-width:768px){
  .pax-row{grid-template-columns:1fr}
  .pax-actions{justify-content:flex-end}
  .pax-grid{grid-template-columns:repeat(2,minmax(0,1fr))} /* 2 æ¬„ */
  .pax-cell.span-2{grid-column:1/-1}
}
@media (max-width:480px){
  .pax-grid{grid-template-columns:1fr} /* æ‰‹æ©Ÿå–®æ¬„ */
}


</style>
</body>
</html>
