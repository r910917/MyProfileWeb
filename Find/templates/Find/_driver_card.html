{# templates/Find/_driver_card.html #}
<li class="card driver-card" data-driver="{{ d.id }}">
  <div class="driver-grid">
    <!-- å·¦ï¼šæš±ç¨± - åº§ä½ -->
    <div class="col-left">
      <div class="name-seat">
        <b>{{ d.driver_name }}</b> - åº§ä½ï¼š{{ d.seats_filled }}/{{ d.seats_total }}
      </div>
    </div>

    <!-- ä¸­ï¼šä¸‰è¡Œè³‡è¨Š -->
    <div class="col-middle">
      <div class="line line1">{{ d.departure }} â†’ {{ d.destination }} | é…Œæ”¶è²»ç”¨ï¼š {{ d.fare_note|default:"æœªå¡«" }}</div>
      <div class="line line2">å‡ºç™¼ï¼š{{ d.date }}ã€€|ã€€å›ç¨‹ï¼š{{ d.return_date|default:"æœªå®š" }}</div>
      <div class="line line3">
        é †è·¯æ¥é€ï¼š
        {% if d.flexible_pickup == "YES" %}é †è·¯å¯è¼‰
        {% elif d.flexible_pickup == "NO" %}ä¸é †è·¯ä¹ŸOK
        {% else %}è¦–æƒ…æ³{% endif %}
      </div>
    </div>

    <!-- å³ï¼šæŒ‰éˆ•èˆ‡ç®­é ­ -->
    <div class="col-actions">
      <button type="button" class="btn-manage" data-action="manage" data-id="{{ d.id }}">ç®¡ç†</button>
      <button
  type="button"
  class="btn-join"
  data-action="join"
  data-id="{{ d.id }}"
  data-date="{{ d.date|date:'Y-m-d' }}"
  data-return="{{ d.return_date|date:'Y-m-d'|default_if_none:'' }}"
  data-total="{{ d.seats_total }}"
  data-filled="{{ d.seats_filled }}"
  data-remaining="{{ d.available|default_if_none:0 }}"
>
  å ±å
</button>
      <button
        id="arrow-{{ d.id }}"
        class="arrow"
        type="button"
        data-action="toggle"
        data-id="{{ d.id }}"
        aria-controls="details-{{ d.id }}"
        aria-expanded="false"
        title="å±•é–‹/æ”¶åˆ"
      >â–¶</button>
    </div>

    <!-- å±•é–‹è©³æƒ…ï¼ˆä½ ç¾æœ‰çš„ä¸‰æ¬„ details-grid3 ç›´æ¥è²¼å›ä¾†å³å¯ï¼‰ -->
    <div id="details-{{ d.id }}" class="details" aria-hidden="true">
      {# === å·¦ä¸­å³ä¸‰æ¬„ï¼ˆå¸æ©Ÿè³‡è¨Š / å¾…ç¢ºèª / å·²æ¥å—ï¼‰=== #}
      <div class="details-grid3">
        <!-- å·¦æ¬„ï¼šå¸æ©Ÿè³‡è¨Š -->
        <div class="details-col">
          <div class="driver-info__title"><span class="emoji">ğŸš—</span><span>å¸æ©Ÿè³‡è¨Š</span></div>
          <div class="driver-info__group">
            <div class="driver-kv">
              <div class="k">æš±ç¨±</div><div class="v">{{ d.driver_name }}</div>
              <div class="k">æ€§åˆ¥</div><div class="v">{{ d.get_gender_display }}</div>
              <!-- <div class="k">Email</div><div class="v">{{ d.email|default:"æœªæä¾›" }}</div> -->
              <div class="k">è¯çµ¡æ–¹å¼</div>
                <div class="v">
                {% if d.hide_contact and d.email %}
                    <span class="muted">å·²éš±è—ï¼ˆä»¥ç³»çµ±ä¿¡é€šçŸ¥ï¼‰</span>
                {% else %}
                    {{ d.contact|default:"æœªå¡«" }}
                {% endif %}
                </div>
            </div>
          </div>
          <div class="driver-info__group">
            <div class="driver-kv">
              <div class="k">å‡ºç™¼æ—¥æœŸ</div><div class="v">{{ d.date }}</div>
              <div class="k">å›ç¨‹æ—¥æœŸ</div><div class="v">{{ d.return_date|default:"æœªå®š" }}</div>
              <div class="k">é †è·¯æ„é¡˜</div>
              <div class="v">
                {% if d.flexible_pickup == "YES" %}é †è·¯å¯è¼‰
                {% elif d.flexible_pickup == "NO" %}ä¸é †è·¯ä¹ŸOK
                {% else %}è¦–æƒ…æ³{% endif %}
              </div>
              <div class="k">é…Œæ”¶è²»ç”¨</div>
              <div class="v">{{ d.fare_note|default:"æœªå¡«" }}</div>
              <div class="k">å‚™è¨»</div><div class="v">{{ d.note|default:"ç„¡" }}</div>
            </div>
          </div>
        </div>

        {# ä¸­æ¬„ï¼šå¾…ç¢ºèª #}
<div class="details-col">
  <h4 class="pax-panel-title">ğŸ§ å¾…ç¢ºèª</h4>
  <div class="pax-scroll">
    {% with pend=d.pending_list %}
    <ul class="pax-list pending-scroll">
      {% if pend %}
        {% for p in pend %}
          <li class="pax-item pax-pending">
            <div class="pax-2col">
              <div class="pax-left">
                <div class="pax-title">{{ p.passenger_name }}</div>
                <div class="pax-sub">ä¸Šè»Šï¼š{{ p.departure }} Â· äººæ•¸ï¼š{{ p.seats_needed }}</div>
              </div>
              <div class="pax-actions">
                <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
                <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">åˆªé™¤</button>
              </div>
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="pax-empty">ç›®å‰æ²’æœ‰å¾…ç¢ºèªä¹˜å®¢</li>
      {% endif %}
    </ul>
    {% endwith %}
  </div>
</div>

{# å³æ¬„ï¼šå·²æ¥å— #}
<div class="details-col">
  <h4 class="pax-panel-title">âœ… å·²æ¥å—</h4>
  <div class="pax-scroll">
    {% with acc=d.accepted_list %}
    <ul class="pax-list accepted-scroll">
      {% if acc %}
        {% for p in acc %}
          <li class="pax-item pax-accepted">
            <div class="pax-2col">
              <div class="pax-left">
                <div class="pax-title"><span class="check">âœ”</span>{{ p.passenger_name }}</div>
                <div class="pax-sub">ä¸Šè»Šï¼š{{ p.departure }} Â· äººæ•¸ï¼š{{ p.seats_needed }}</div>
              </div>
              <div class="pax-actions">
                <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">ç·¨è¼¯</button>
                <button
                  type="button"
                  class="btn-mini danger"
                  data-action="reject"
                  data-id="{{ p.id }}"
                  data-driver="{{ d.id }}"
                  >
                  å–æ¶ˆ
                </button>
              </div>
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="pax-empty">å°šç„¡å·²æ¥å—ä¹˜å®¢</li>
      {% endif %}
    </ul>
    {% endwith %}
  </div>
</div>


      </div>
    </div>
  </div>
</li>
