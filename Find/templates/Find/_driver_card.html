{# templates/Find/_driver_card.html #}
<li class="card driver-card" data-driver="{{ d.id }}">
  <div class="driver-grid">
    <!-- 左：暱稱 - 座位 -->
    <div class="col-left">
      <div class="name-seat">
        <b>{{ d.driver_name }}</b> - 座位：{{ d.seats_filled }}/{{ d.seats_total }}
      </div>
    </div>

    <!-- 中：三行資訊 -->
    <div class="col-middle">
      <div class="line line1">{{ d.departure }} → {{ d.destination }} | 酌收費用： {{ d.fare_note|default:"未填" }}</div>
      <div class="line line2">出發：{{ d.date }}　|　回程：{{ d.return_date|default:"未定" }}</div>
      <div class="line line3">
        順路接送：
        {% if d.flexible_pickup == "YES" %}順路可載
        {% elif d.flexible_pickup == "NO" %}不順路也OK
        {% else %}視情況{% endif %}
      </div>
    </div>

    <!-- 右：按鈕與箭頭 -->
    <div class="col-actions">
      <button type="button" class="btn-manage" data-action="manage" data-id="{{ d.id }}">管理</button>
      <button
  type="button"
  class="btn-join"
  data-action="join"
  data-id="{{ d.id }}"
  data-date="{{ d.date|date:'Y-m-d' }}"
  data-return="{{ d.return_date|date:'Y-m-d'|default_if_none:'' }}"
  data-total="{{ d.seats_total }}"
  data-filled="{{ d.seats_filled }}"
  data-remaining="{{ d.available|default_if_none:0 }}"
>
  報名
</button>
      <button
        id="arrow-{{ d.id }}"
        class="arrow"
        type="button"
        data-action="toggle"
        data-id="{{ d.id }}"
        aria-controls="details-{{ d.id }}"
        aria-expanded="false"
        title="展開/收合"
      >▶</button>
    </div>

    <!-- 展開詳情（你現有的三欄 details-grid3 直接貼回來即可） -->
    <div id="details-{{ d.id }}" class="details" aria-hidden="true">
      {# === 左中右三欄（司機資訊 / 待確認 / 已接受）=== #}
      <div class="details-grid3">
        <!-- 左欄：司機資訊 -->
        <div class="details-col">
          <div class="driver-info__title"><span class="emoji">🚗</span><span>司機資訊</span></div>
          <div class="driver-info__group">
            <div class="driver-kv">
              <div class="k">暱稱</div><div class="v">{{ d.driver_name }}</div>
              <div class="k">性別</div><div class="v">{{ d.get_gender_display }}</div>
              <!-- <div class="k">Email</div><div class="v">{{ d.email|default:"未提供" }}</div> -->
              <div class="k">聯絡方式</div>
                <div class="v">
                {% if d.hide_contact and d.email %}
                    <span class="muted">已隱藏（以系統信通知）</span>
                {% else %}
                    {{ d.contact|default:"未填" }}
                {% endif %}
                </div>
            </div>
          </div>
          <div class="driver-info__group">
            <div class="driver-kv">
              <div class="k">出發日期</div><div class="v">{{ d.date }}</div>
              <div class="k">回程日期</div><div class="v">{{ d.return_date|default:"未定" }}</div>
              <div class="k">順路意願</div>
              <div class="v">
                {% if d.flexible_pickup == "YES" %}順路可載
                {% elif d.flexible_pickup == "NO" %}不順路也OK
                {% else %}視情況{% endif %}
              </div>
              <div class="k">酌收費用</div>
              <div class="v">{{ d.fare_note|default:"未填" }}</div>
              <div class="k">備註</div><div class="v">{{ d.note|default:"無" }}</div>
            </div>
          </div>
        </div>

        {# 中欄：待確認 #}
<div class="details-col">
  <h4 class="pax-panel-title">🧍 待確認</h4>
  <div class="pax-scroll">
    {% with pend=d.pending_list %}
    <ul class="pax-list pending-scroll">
      {% if pend %}
        {% for p in pend %}
          <li class="pax-item pax-pending">
            <div class="pax-2col">
              <div class="pax-left">
                <div class="pax-title">{{ p.passenger_name }}</div>
                <div class="pax-sub">上車：{{ p.departure }} · 人數：{{ p.seats_needed }}</div>
              </div>
              <div class="pax-actions">
                <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">編輯</button>
                <button type="button" class="btn-mini danger" data-pax-del data-id="{{ p.id }}">刪除</button>
              </div>
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="pax-empty">目前沒有待確認乘客</li>
      {% endif %}
    </ul>
    {% endwith %}
  </div>
</div>

{# 右欄：已接受 #}
<div class="details-col">
  <h4 class="pax-panel-title">✅ 已接受</h4>
  <div class="pax-scroll">
    {% with acc=d.accepted_list %}
    <ul class="pax-list accepted-scroll">
      {% if acc %}
        {% for p in acc %}
          <li class="pax-item pax-accepted">
            <div class="pax-2col">
              <div class="pax-left">
                <div class="pax-title"><span class="check">✔</span>{{ p.passenger_name }}</div>
                <div class="pax-sub">上車：{{ p.departure }} · 人數：{{ p.seats_needed }}</div>
              </div>
              <div class="pax-actions">
                <button type="button" class="btn-mini" data-pax-edit data-id="{{ p.id }}">編輯</button>
                <button
                  type="button"
                  class="btn-mini danger"
                  data-action="reject"
                  data-id="{{ p.id }}"
                  data-driver="{{ d.id }}"
                  >
                  取消
                </button>
              </div>
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="pax-empty">尚無已接受乘客</li>
      {% endif %}
    </ul>
    {% endwith %}
  </div>
</div>


      </div>
    </div>
  </div>
</li>
