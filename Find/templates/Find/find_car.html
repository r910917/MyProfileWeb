<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>ğŸš— æ–°å¢å‡ºè»Šè³‡è¨Š</title>
  <style>
    body { font-family:"Microsoft JhengHei",sans-serif; background:linear-gradient(to right,#f0f9ff,#fefefe); margin:0; padding:40px 20px; }
    h2 { text-align:center; color:#005c4b; margin-bottom:25px; font-size:26px; }
    form { max-width:600px; margin:0 auto; background:#fff; padding:25px 30px; border-radius:16px; box-shadow:0 6px 12px rgba(0,0,0,.1); animation:fadeIn .5s ease-in-out; }
    label { font-weight:700; display:block; margin-top:12px; margin-bottom:6px; color:#444; }
    input,textarea,select { width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ccc; transition:border-color .3s, box-shadow .3s; font-size:15px; }
    input:focus,textarea:focus,select:focus { border-color:#007bff; box-shadow:0 0 8px rgba(0,123,255,.3); outline:none; }
    textarea { min-height:80px; resize:vertical; }
    button { width:100%; padding:14px; border:0; border-radius:10px; background:linear-gradient(45deg,#007bff,#00b894);color:#fff ; font-size:18px; font-weight:700; cursor:pointer; transition:background .3s, transform .2s; }
    button:hover { background:linear-gradient(45deg,#0056b3,#009e77); transform:scale(1.02); }
    .alert { max-width:600px; margin:0 auto 12px; padding:12px 14px; border-radius:10px; }
    .alert-danger { background:#fdeaea; color:#7f1d1d; border:1px solid #f5c2c7; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }
    .required::after{ content:" *"; color:red; }

    /* å¡ç‰‡å®¹å™¨ */
    .pref-card{
      border:1px solid #e5e7eb; background:#f9fafb; border-radius:12px;
      padding:14px; margin:12px 0;
    }

    /* æ¯ä¸€åˆ—ï¼ˆé–‹é—œ + æ–‡å­—ï¼‰ */
    .pref-row{ display:flex; align-items:center; gap:12px; padding:6px 2px; }
    .pref-row.sub{ padding-left:44px; }       /* ç¬¬äºŒåˆ—ç¸®æ’ï¼Œçœ‹èµ·ä¾†æ˜¯é™„å±¬é¸é … */

    /* æ–‡å­—å€ */
    .pref-text{ display:flex; flex-direction:column; gap:2px; }
    .pref-title{ font-weight:600; color:#1f2937; }
    .pref-desc{ font-size:.9rem; color:#6b7280; }

    /* åº•éƒ¨èªªæ˜ */
    .pref-hint{ margin-top:8px; font-size:.85rem; color:#6b7280; }
    .pref-hint.hint-error{ color:#b91c1c; }

    /* æ»‘å‹•é–‹é—œï¼ˆèˆ‡ iOS é¢¨æ ¼ç›¸è¿‘ï¼‰ */
.switch{ position:relative; display:inline-block; width:52px; height:28px; }
.switch input{ display:none; }
.slider{
  position:absolute; inset:0; cursor:pointer; background:#e5e7eb; border-radius:999px;
  transition:background .2s ease;
}
.slider:before{
  content:""; position:absolute; height:22px; width:22px; left:3px; top:3px;
  background:white; border-radius:999px; transition:transform .2s ease;
  box-shadow:0 1px 2px rgba(0,0,0,.15);
}
.switch input:checked + .slider{ background:#10b981; }          /* ç¶ è‰²é–‹å•Ÿ */
.switch input:checked + .slider:before{ transform:translateX(24px); }

/* å°è¢å¹•å¾®èª¿ */
@media (max-width: 480px){
  .pref-row.sub{ padding-left:36px; }
}

/* åªå½±éŸ¿ã€Œæ˜¯å¦é–‹æ”¾ã€é€™ä¸€é¡†ï¼Œé¿å…è¢«å…¨ç«™ .switch å½±éŸ¿ */
#active-switch{
  display:flex; align-items:center; gap:.6rem;
  user-select:none;
}
#active-switch input[type="checkbox"]{
  /* éš±è—åŸæœ¬ checkboxï¼ˆä»å¯è¢« label é»æ“Šï¼‰ */
  position:absolute; opacity:0; width:0; height:0;
}

/* Toggle å¤–è§€ */
#active-switch .toggle{
  position:relative; width:48px; height:26px;
  border-radius:999px; background:#e5e7eb; /* gray-200 */
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
  transition: background .2s ease;
}

/* åœ“é» */
#active-switch .toggle::after{
  content:""; position:absolute; top:3px; left:3px;
  width:20px; height:20px; border-radius:50%;
  background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.2);
  transition: transform .2s cubic-bezier(.4,0,.2,1);
}

/* å‹¾é¸ç‹€æ…‹ */
#active-switch input[type="checkbox"]:checked + .toggle{
  background:#10b981;               /* teal/green */
}
#active-switch input[type="checkbox"]:checked + .toggle::after{
  transform: translateX(22px);
}

/* æ–‡å­—æ¨™ç±¤ */
#active-switch label{
  cursor:pointer; color:#374151;     /* gray-700 */
  font-size:.95rem; line-height:1.2;
}

/* éµç›¤å¯åŠæ€§ï¼ˆç„¦é»è¼ªå»“è½åœ¨å¯è¦–çš„ .toggle ä¸Šï¼‰ */
#active-switch input[type="checkbox"]:focus + .toggle{
  outline: 2px solid #2563eb; outline-offset: 2px;
}

    .muted { color:#6b7280; font-size:12px; display:block; margin-top:6px; }
    .hint-error { color:#b91c1c; }
    /* =============== æ‰‹æ©Ÿï¼å°å¹³æ¿å¼·åŒ– =============== */
    @media (max-width: 768px) {
      body {
        padding: 24px 14px;
        background: #f6f9fc;
      }
      h2 { font-size: 22px; margin-bottom: 18px; }

      form {
        max-width: 640px;
        padding: 18px 16px;
        border-radius: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,.08);
      }

      /* æ¬„ä½å­—ç´šèˆ‡é–“è· */
      label { font-size: 14px; margin-top: 10px; margin-bottom: 6px; }
      input, textarea, select {
        /* iOS < 16 æœƒå› å°æ–¼ 16px è‡ªå‹•æ”¾å¤§ï¼Œé€™è£¡é– 16px */
        font-size: 16px;
        padding: 12px 12px;
        border-radius: 10px;
        margin-bottom: 12px;
      }
      textarea { min-height: 96px; }

      /* switch å€å¡Šå †ç–Šæ›´é¬† */
      .switch {
        gap: 12px;
        padding: 10px 12px;
        border-radius: 12px;
      }

      /* é€å‡ºéµæ›´å¤§ã€æ›´å¥½é» */
      button {
        font-size: 17px;
        padding: 14px;
        border-radius: 12px;
      }

      .alert { margin-bottom: 12px; }
      .muted { font-size: 12px; }
    }

    /* è¶…å°è¢å¹•ï¼ˆå¦‚ 360pxï¼‰å†ç·Šä¸€é» */
    @media (max-width: 420px) {
      body { padding: 18px 10px; }
      h2 { font-size: 20px; }
      form { padding: 14px 12px; border-radius: 12px; }
      label { font-size: 13px; }
      input, textarea, select { padding: 11px 10px; }
    }

    /* =============== å¯é¸ï¼šé€å‡ºéµå¸é™„åº•éƒ¨ï¼ˆä¸æ”¹ HTML çµæ§‹ï¼‰ =============== */
    /* ä½œæ³• Aï¼šç›´æ¥æŠŠ form æœ€å¾Œä¸€é¡† <button> åŠ ä¸Š .sticky-submit class */
    .sticky-submit {
      position: sticky;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);
      z-index: 2;
      /* è®“å®ƒæµ®èµ·ä¾†ä¸€é» */
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
    }

    /* ä½œæ³• Bï¼šä¸æ”¹ HTMLï¼Œç”± JS è‡ªå‹•å¹«æœ€å¾Œä¸€é¡† button åŠ  .sticky-submit
      â†’ å°‡ä¸‹æ–¹ JS è²¼åˆ°é å°¾å³å¯ */
    /* è®“ sticky èƒ½æ­£å¸¸é‹ä½œã€ä¸¦é ç•™åº•éƒ¨ç©ºé–“ï¼ˆé¿å…è¢«éµç›¤æˆ–å®‰å…¨å€é®ä½ï¼‰ */
html, body { height: 100%; }
form { 
  /* é ç•™çµ¦å¸åº•æŒ‰éˆ•çš„ç©ºé–“ */
  padding-bottom: max(96px, calc(env(safe-area-inset-bottom, 0px) + 96px));
}

/* å¸åº•é€å‡ºéµï¼šæœ‰åº•è‰²èˆ‡é™°å½±ï¼Œæ‰‹æ©Ÿä¸Šæ›´æ˜é¡¯ */
.sticky-submit {
  position: sticky;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);
  z-index: 10;
  box-shadow: 0 6px 16px rgba(0,0,0,.15);
  background: #fff;         /* è®“æŒ‰éˆ•åº•ä¸‹ä¸æœƒé€å‡ºè¡¨å–® */
  border: 1px solid #e5e7eb;
}

/* iOS 16 ä»¥ä¸‹é˜²ç¸®æ”¾ï¼ˆä½ å·²æŠŠ input å­—ç´šæ‹‰åˆ° 16pxï¼Œé€™è£¡å†ä¿éšªï¼‰ */
@supports (-webkit-touch-callout: none) {
  input, select, textarea, button { font-size: 16px; }
}

/* æ‰‹æ©Ÿç‰ˆå¼·åŒ–ï¼ˆç¶­æŒä½ åŸæœ¬çš„æ¨£å¼ï¼Œé€™é‚Šåªç¢ºä¿æœƒç”Ÿæ•ˆï¼‰ */
@media (max-width: 768px) {
  body { padding: 24px 14px; background: #f6f9fc; }
  h2 { font-size: 22px; margin-bottom: 18px; }
  form {
    max-width: 640px;
    padding: 18px 16px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,.08);
  }
  label { font-size: 14px; margin-top: 10px; margin-bottom: 6px; }
  input, textarea, select {
    font-size: 16px;
    padding: 12px 12px;
    border-radius: 10px;
    margin-bottom: 12px;
  }
  textarea { min-height: 96px; }
  .switch { gap: 12px; padding: 10px 12px; border-radius: 12px; }
  button { font-size: 17px; padding: 14px; border-radius: 12px; }
}


  </style>
</head>
<body>
  <h2>ğŸš— æ–°å¢å‡ºè»Šè³‡è¨Š</h2>

  <form method="POST" id="driverCreateForm">
    {% csrf_token %}

    <label for="nickname" class="required">æš±ç¨±</label>
    <input type="text" name="name" id="nickname" value="{{ prefill.name|default:'' }}" required />

    <label for="gender" class="required">æ€§åˆ¥</label>
    <select name="gender" id="gender" required>
      <option value="" {% if not prefill.gender %}selected{% endif %}>æœªæŒ‡å®š</option>
      <option value="M" {% if prefill.gender == 'M' %}selected{% endif %}>ç”·ç”Ÿ</option>
      <option value="F" {% if prefill.gender == 'F' %}selected{% endif %}>å¥³ç”Ÿ</option>
      <option value="X" {% if prefill.gender == 'X' %}selected{% endif %}>ä¸æ–¹ä¾¿é€æ¼</option>
    </select>

    <label for="email">Email</label>
    <input type="email" name="email" id="email" value="{{ prefill.email|default:'' }}" placeholder="é¸å¡«ï¼Œåƒ…ç”¨æ–¼å¯„é€é€šçŸ¥ï¼ˆä¸å…¬é–‹ï¼‰" />

    <!-- ğŸ”’ éš±è—å€‹è³‡ï¼ˆéœ€è¦ Email æ‰èƒ½å•Ÿç”¨ï¼›å¸æ©Ÿé è¨­å‹¾é¸ï¼‰ -->
    <label>éš±ç§è¨­å®š</label>
    <!-- éš±ç§è¨­å®šï¼šå¡ç‰‡ + å…©å€‹æ»‘å‹•é–‹é—œ -->
    <section class="pref-card">
      <div class="pref-row">
        <label class="switch">
          <input type="checkbox" id="hide_contact" name="hide_contact"
                {% if prefill.hide_contact is not defined or prefill.hide_contact %}checked{% endif %}>
          <span class="slider"></span>
        </label>
        <div class="pref-text">
          <div class="pref-title">éš±è—å€‹è³‡ï¼ˆè¯çµ¡æ–¹å¼ï¼‰</div>
          <div class="pref-desc"></div>
        </div>
      </div>

      <div id="autoEmailWrap" class="pref-row sub" style="display:none;">
        <label class="switch">
          <input type="checkbox" id="auto_email_contact" name="auto_email_contact"
                {% if prefill.auto_email_contact %}checked{% endif %}>
          <span class="slider"></span>
        </label>
        <div class="pref-text">
          <div class="pref-title">éš±è—æ™‚ï¼Œè‡ªå‹•æŠŠæˆ‘çš„è¯çµ¡æ–¹å¼ Email çµ¦å·²å ±åä¹˜å®¢</div>
        </div>
      </div>

      <div id="privacyHint" class="pref-hint">
        â€» éœ€å¡«å¯« Email æ‰èƒ½éš±è—ï¼›Email åƒ…ä¾›ç³»çµ±é€šçŸ¥ï¼Œä¸æœƒå…¬é–‹ã€‚
      </div>
    </section>


    <label for="contact" class="required">è¯çµ¡æ–¹å¼</label>
    <input type="text" name="contact" id="contact" value="{{ prefill.contact|default:'' }}" placeholder="LINEã€IG æˆ–æ‰‹æ©Ÿè™Ÿç¢¼" required />

    <label for="password" class="required">ç®¡ç†å¯†ç¢¼</label>
    <input type="password" name="password" id="password" value="{{ prefill.password|default:'' }}" placeholder="å»ºè­° 4 ç¢¼ï¼Œé è¨­ 0000 æ–¹ä¾¿ç®¡ç†" />

    <label for="flexible_pickup" class="required">é †è·¯æ¥é€æ„é¡˜</label>
    <select name="flexible_pickup" id="flexible_pickup" required>
      <option value="YES"  {% if prefill.flexible_pickup == 'YES' %}selected{% endif %}>é †è·¯å¯è¼‰</option>
      <option value="NO"   {% if prefill.flexible_pickup == 'NO' %}selected{% endif %}>ä¸é †è·¯ä¹ŸOK</option>
      <option value="MAYBE" {% if prefill.flexible_pickup == 'MAYBE' or not prefill.flexible_pickup %}selected{% endif %}>è¦–æƒ…æ³</option>
    </select>

    <label for="seats_total" class="required">ç¸½åº§ä½</label>
    <input type="number" name="seats_total" id="seats_total" min="1" value="{{ prefill.seats_total|default:'1' }}" required />

    <label for="departure" class="required">å‡ºç™¼åœ°</label>
    <select name="departure" id="departure" onchange="checkCustomDeparture(this)" required>
      <option value="" {% if not prefill.departure %}selected{% endif %}>è«‹é¸æ“‡ç¸£å¸‚</option>
      <option value="è‡ªå¡«" {% if prefill.departure == 'è‡ªå¡«' %}selected{% endif %}>å…¶ä»–</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©é„‰"  {% if prefill.destination == 'èŠ±è“®ç¸£å…‰å¾©é„‰' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©é„‰</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™"  {% if prefill.destination == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™"  {% if prefill.destination == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™</option>
      <option value="å…‰å¾©é„‰ç³–å» "  {% if prefill.destination == 'å…‰å¾©é„‰ç³–å» ' %}selected{% endif %}>å…‰å¾©é„‰ç³–å» </option>
      <option value="éœ€æ¸…æ·¤åœ°å€"  {% if prefill.destination == 'éœ€æ¸…æ·¤åœ°å€' %}selected{% endif %}>éœ€æ¸…æ·¤åœ°å€</option>
      <option value="å°åŒ—å¸‚"  {% if prefill.departure == 'å°åŒ—å¸‚' %}selected{% endif %}>å°åŒ—å¸‚</option>
      <option value="æ–°åŒ—å¸‚"  {% if prefill.departure == 'æ–°åŒ—å¸‚' %}selected{% endif %}>æ–°åŒ—å¸‚</option>
      <option value="åŸºéš†å¸‚"  {% if prefill.departure == 'åŸºéš†å¸‚' %}selected{% endif %}>åŸºéš†å¸‚</option>
      <option value="æ¡ƒåœ’å¸‚"  {% if prefill.departure == 'æ¡ƒåœ’å¸‚' %}selected{% endif %}>æ¡ƒåœ’å¸‚</option>
      <option value="æ–°ç«¹å¸‚"  {% if prefill.departure == 'æ–°ç«¹å¸‚' %}selected{% endif %}>æ–°ç«¹å¸‚</option>
      <option value="æ–°ç«¹ç¸£"  {% if prefill.departure == 'æ–°ç«¹ç¸£' %}selected{% endif %}>æ–°ç«¹ç¸£</option>
      <option value="è‹—æ —ç¸£"  {% if prefill.departure == 'è‹—æ —ç¸£' %}selected{% endif %}>è‹—æ —ç¸£</option>
      <option value="å°ä¸­å¸‚"  {% if prefill.departure == 'å°ä¸­å¸‚' %}selected{% endif %}>å°ä¸­å¸‚</option>
      <option value="å½°åŒ–ç¸£"  {% if prefill.departure == 'å½°åŒ–ç¸£' %}selected{% endif %}>å½°åŒ–ç¸£</option>
      <option value="å—æŠ•ç¸£"  {% if prefill.departure == 'å—æŠ•ç¸£' %}selected{% endif %}>å—æŠ•ç¸£</option>
      <option value="é›²æ—ç¸£"  {% if prefill.departure == 'é›²æ—ç¸£' %}selected{% endif %}>é›²æ—ç¸£</option>
      <option value="å˜‰ç¾©å¸‚"  {% if prefill.departure == 'å˜‰ç¾©å¸‚' %}selected{% endif %}>å˜‰ç¾©å¸‚</option>
      <option value="å˜‰ç¾©ç¸£"  {% if prefill.departure == 'å˜‰ç¾©ç¸£' %}selected{% endif %}>å˜‰ç¾©ç¸£</option>
      <option value="å°å—å¸‚"  {% if prefill.departure == 'å°å—å¸‚' %}selected{% endif %}>å°å—å¸‚</option>
      <option value="é«˜é›„å¸‚"  {% if prefill.departure == 'é«˜é›„å¸‚' %}selected{% endif %}>é«˜é›„å¸‚</option>
      <option value="å±æ±ç¸£"  {% if prefill.departure == 'å±æ±ç¸£' %}selected{% endif %}>å±æ±ç¸£</option>
      <option value="å®œè˜­ç¸£"  {% if prefill.departure == 'å®œè˜­ç¸£' %}selected{% endif %}>å®œè˜­ç¸£</option>
      <option value="èŠ±è“®ç¸£"  {% if prefill.departure == 'èŠ±è“®ç¸£' %}selected{% endif %}>èŠ±è“®ç¸£</option>
      <option value="å°æ±ç¸£"  {% if prefill.departure == 'å°æ±ç¸£' %}selected{% endif %}>å°æ±ç¸£</option>
      <option value="æ¾æ¹–ç¸£"  {% if prefill.departure == 'æ¾æ¹–ç¸£' %}selected{% endif %}>æ¾æ¹–ç¸£</option>
      <option value="é‡‘é–€ç¸£"  {% if prefill.departure == 'é‡‘é–€ç¸£' %}selected{% endif %}>é‡‘é–€ç¸£</option>
      <option value="é€£æ±Ÿç¸£"  {% if prefill.departure == 'é€£æ±Ÿç¸£' %}selected{% endif %}>é€£æ±Ÿç¸£</option>
    </select>

    <input type="text" id="customDeparture" name="departure_custom"
           value="{{ prefill.departure_custom|default:'' }}"
           style="display:{% if prefill.departure == 'è‡ªå¡«' or prefill.departure_custom %}block{% else %}none{% endif %};"
           placeholder="è¼¸å…¥è‡ªè¨‚å‡ºç™¼åœ°" />

    <label for="destination">ç›®çš„åœ°</label>
    <select name="destination" id="destination" onchange="checkCustomDestination(this)">
      <option value="" {% if not prefill.destination %}selected{% endif %}>è«‹é¸æ“‡ç¸£å¸‚</option>
      <option value="è‡ªå¡«" {% if prefill.destination == 'è‡ªå¡«' %}selected{% endif %}>å…¶ä»–</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©é„‰"  {% if prefill.destination == 'èŠ±è“®ç¸£å…‰å¾©é„‰' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©é„‰</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™"  {% if prefill.destination == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™ä»¥å¤–ç«è»Šç«™</option>
      <option value="èŠ±è“®ç¸£å…‰å¾©è»Šç«™"  {% if prefill.destination == 'èŠ±è“®ç¸£å…‰å¾©è»Šç«™' %}selected{% endif %}>èŠ±è“®ç¸£å…‰å¾©è»Šç«™</option>
      <option value="å…‰å¾©é„‰ç³–å» "  {% if prefill.destination == 'å…‰å¾©é„‰ç³–å» ' %}selected{% endif %}>å…‰å¾©é„‰ç³–å» </option>
      <option value="éœ€æ¸…æ·¤åœ°å€"  {% if prefill.destination == 'éœ€æ¸…æ·¤åœ°å€' %}selected{% endif %}>éœ€æ¸…æ·¤åœ°å€</option>
      <option value="å°åŒ—å¸‚"  {% if prefill.destination == 'å°åŒ—å¸‚' %}selected{% endif %}>å°åŒ—å¸‚</option>
      <option value="æ–°åŒ—å¸‚"  {% if prefill.destination == 'æ–°åŒ—å¸‚' %}selected{% endif %}>æ–°åŒ—å¸‚</option>
      <option value="åŸºéš†å¸‚"  {% if prefill.destination == 'åŸºéš†å¸‚' %}selected{% endif %}>åŸºéš†å¸‚</option>
      <option value="æ¡ƒåœ’å¸‚"  {% if prefill.destination == 'æ¡ƒåœ’å¸‚' %}selected{% endif %}>æ¡ƒåœ’å¸‚</option>
      <option value="æ–°ç«¹å¸‚"  {% if prefill.destination == 'æ–°ç«¹å¸‚' %}selected{% endif %}>æ–°ç«¹å¸‚</option>
      <option value="æ–°ç«¹ç¸£"  {% if prefill.destination == 'æ–°ç«¹ç¸£' %}selected{% endif %}>æ–°ç«¹ç¸£</option>
      <option value="è‹—æ —ç¸£"  {% if prefill.destination == 'è‹—æ —ç¸£' %}selected{% endif %}>è‹—æ —ç¸£</option>
      <option value="å°ä¸­å¸‚"  {% if prefill.destination == 'å°ä¸­å¸‚' %}selected{% endif %}>å°ä¸­å¸‚</option>
      <option value="å½°åŒ–ç¸£"  {% if prefill.destination == 'å½°åŒ–ç¸£' %}selected{% endif %}>å½°åŒ–ç¸£</option>
      <option value="å—æŠ•ç¸£"  {% if prefill.destination == 'å—æŠ•ç¸£' %}selected{% endif %}>å—æŠ•ç¸£</option>
      <option value="é›²æ—ç¸£"  {% if prefill.destination == 'é›²æ—ç¸£' %}selected{% endif %}>é›²æ—ç¸£</option>
      <option value="å˜‰ç¾©å¸‚"  {% if prefill.destination == 'å˜‰ç¾©å¸‚' %}selected{% endif %}>å˜‰ç¾©å¸‚</option>
      <option value="å˜‰ç¾©ç¸£"  {% if prefill.destination == 'å˜‰ç¾©ç¸£' %}selected{% endif %}>å˜‰ç¾©ç¸£</option>
      <option value="å°å—å¸‚"  {% if prefill.destination == 'å°å—å¸‚' %}selected{% endif %}>å°å—å¸‚</option>
      <option value="é«˜é›„å¸‚"  {% if prefill.destination == 'é«˜é›„å¸‚' %}selected{% endif %}>é«˜é›„å¸‚</option>
      <option value="å±æ±ç¸£"  {% if prefill.destination == 'å±æ±ç¸£' %}selected{% endif %}>å±æ±ç¸£</option>
      <option value="å®œè˜­ç¸£"  {% if prefill.destination == 'å®œè˜­ç¸£' %}selected{% endif %}>å®œè˜­ç¸£</option>
      <option value="èŠ±è“®ç¸£"  {% if prefill.destination == 'èŠ±è“®ç¸£' %}selected{% endif %}>èŠ±è“®ç¸£</option>
      <option value="å°æ±ç¸£"  {% if prefill.destination == 'å°æ±ç¸£' %}selected{% endif %}>å°æ±ç¸£</option>
      <option value="æ¾æ¹–ç¸£"  {% if prefill.destination == 'æ¾æ¹–ç¸£' %}selected{% endif %}>æ¾æ¹–ç¸£</option>
      <option value="é‡‘é–€ç¸£"  {% if prefill.destination == 'é‡‘é–€ç¸£' %}selected{% endif %}>é‡‘é–€ç¸£</option>
      <option value="é€£æ±Ÿç¸£"  {% if prefill.destination == 'é€£æ±Ÿç¸£' %}selected{% endif %}>é€£æ±Ÿç¸£</option>
    </select>

    <input type="text"
           id="customDestination"
           name="destination_custom"
           value="{{ prefill.destination_custom|default:'' }}"
           style="display:{% if prefill.destination == 'è‡ªå¡«' or prefill.destination_custom %}block{% else %}none{% endif %};"
           placeholder="è¼¸å…¥è‡ªè¨‚ç›®çš„åœ°" />

    <label for="driver-fare-note">é…Œæ”¶è²»ç”¨ï¼ˆé¸å¡«ï¼‰</label>
    <input type="text" id="driver-fare-note" name="fare_note"
           value="{{ prefill.fare_note|default:'' }}"
           placeholder="ä¾‹å¦‚ï¼šæ¯äºº 200ã€æ²¹éŒ¢å‡æ”¤ã€è¦–é‡Œç¨‹è€Œå®šâ€¦" />

    <label for="driver-date" class="required">å‡ºç™¼æ—¥æœŸ</label>
    <input type="date" name="date" id="driver-date" value="{{ prefill.date|default:'' }}" required />
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <label for="driver-return">å›ç¨‹æ—¥æœŸï¼ˆé¸å¡«ï¼‰</label>
    <input type="date" name="return_date" id="driver-return" value="{{ prefill.return_date|default:'' }}" />

    <label for="note">å‚™è¨»</label>
    <textarea name="note" id="note" placeholder="å‡ºç™¼æ™‚é–“(ä¸Šåˆã€ä¸‹åˆã€å‡Œæ™¨)ï¼Œéœ€è¦æœƒé–‹è»Š(å¯ä»¥è¼ªæµé–‹)......ç­‰">{{ prefill.note|default:'' }}</textarea>

    <button type="submit">âœ… é€å‡º</button>
    <div style="max-width:600px;margin:0 auto 8px;">
      <a href="{% url 'find_index' %}" class="btn-ghost" style="display:inline-block;text-decoration:none;text-align:center;width:96%;padding:12px;margin-top:10px;border-radius:10px;font-weight:700;">
        ğŸ  å›é¦–é 
      </a>
    </div>
  </form>
  

  <script>
    // å‡ºç™¼/ç›®çš„ç‚ºã€Œè‡ªå¡«ã€æ™‚é¡¯ç¤ºè‡ªè¨‚è¼¸å…¥æ¡†
    function checkCustomDeparture(select){
      const customInput = document.getElementById('customDeparture');
      if (!customInput) return;
      const show = (select.value === 'è‡ªå¡«');
      customInput.style.display = show ? 'block' : 'none';
      customInput.required = show;
      if (!show) customInput.value = '';
    }
    function checkCustomDestination(select){
      const input = document.getElementById('customDestination');
      if (!input) return;
      const show = (select.value === 'è‡ªå¡«');
      input.style.display = show ? 'block' : 'none';
      input.required = show;
      if (!show) input.value = '';
    }

    // å›ç¨‹æ—¥æœŸä¸å¯æ—©æ–¼å‡ºç™¼æ—¥æœŸï¼ˆå‰ç«¯å³æ™‚é˜²å‘†ï¼‰
    document.addEventListener('DOMContentLoaded', () => {
      const dep = document.getElementById('driver-date');
      const ret = document.getElementById('driver-return');
      if (!dep || !ret) return;
      function syncMin(){
        ret.min = dep.value || '';
        if (ret.value && dep.value && ret.value < dep.value) ret.value = '';
      }
      dep.addEventListener('change', syncMin);
      syncMin();
    });

    // éš±ç§é–‹é—œï¼šéœ€è¦ Email æ‰èƒ½å•Ÿç”¨
    (function(){
      const email   = document.getElementById('email');
      const hide    = document.getElementById('hide_contact');
      const hint    = document.getElementById('privacyHint');
      const autoRow = document.getElementById('autoEmailWrap');
      const autoBox = document.getElementById('auto_email_contact');

      function hasValidEmail(){
        const v = (email?.value || '').trim();
        return v && v.includes('@');
      }

      function syncAutoRow(){
        const show = !!(hide && hide.checked);
        if (autoRow) autoRow.style.display = show ? '' : 'none';
        if (!show && autoBox) autoBox.checked = false;       // é—œé–‰éš±è—å€‹è³‡æ™‚ï¼Œè‡ªå‹•å¯„ä¿¡ä¹Ÿé—œæ‰
      }

      function syncPrivacy(){
        const ok = hasValidEmail();

        if (!ok){
          // æ²’ Emailï¼šä¸å¾—éš±è—ï¼Œä¹Ÿä¸é¡¯ç¤ºæ¬¡é–‹é—œ
          if (hide){ hide.checked = false; hide.disabled = true; }
          if (autoBox) autoBox.checked = false;
          if (hint){ hint.classList.add('hint-error'); hint.textContent = 'â€» å°šæœªå¡«å¯« Emailï¼Œç„¡æ³•éš±è—è¯çµ¡æ–¹å¼ã€‚'; }
        }else{
          // æœ‰ Emailï¼šå¯ä»¥æ“ä½œï¼Œä½†ã€Œéš±è—å€‹è³‡ã€é è¨­é—œé–‰
          if (hide){
            hide.disabled = false;
            // ä¸è¦è‡ªå‹•æ‰“é–‹éš±è—å€‹è³‡ï¼›ä¿æŒä½¿ç”¨è€…åŸæœ¬é¸æ“‡
            // è‹¥æƒ³ä¸€å¾‹é è¨­é—œï¼šå¯å¼·åˆ¶ hide.checked = false; è¦–éœ€è¦æ‰“é–‹è¨»è§£
            // hide.checked = false;
          }
          if (hint){ hint.classList.remove('hint-error'); hint.innerHTML = `
          â€» Email åƒ…ä¾›ç³»çµ±é€šçŸ¥ï¼Œä¸æœƒå…¬é–‹ã€‚<br>
          è‹¥é—œé–‰è‡ªå‹•å¯„é€ Emailï¼Œå‰‡éœ€ç­‰å¾…ä¹˜å®¢åŠ å…¥å¾Œè‡ªå‹•å°‡ä¹˜å®¢è³‡æ–™å¯„é€è‡³æ‚¨çš„ Emailã€‚
          `; }
        }

        syncAutoRow();
      }

      // åˆ‡æ›ã€Œéš±è—å€‹è³‡ã€ï¼šè‹¥æ‰“é–‹ï¼Œå°±é è¨­æŠŠã€Œè‡ªå‹•å¯„ä¿¡ã€æ‰“é–‹
      hide?.addEventListener('change', ()=>{
        if (hide.checked && autoBox){
          autoBox.checked = true;         // éœ€æ±‚ï¼šæ‰“é–‹éš±è—å€‹è³‡æ™‚ï¼Œè‡ªå‹•å¯„ä¿¡é è¨­é–‹å•Ÿ
        }else if (autoBox){
          autoBox.checked = false;
        }
        syncAutoRow();
      });

      email?.addEventListener('input', syncPrivacy);

      // åˆå§‹åŒæ­¥
      syncPrivacy();
    })();
  </script>

</body>
</html>
